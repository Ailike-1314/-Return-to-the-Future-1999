/*!
 * @form-create/vant v3.2.13
 * (c) 2018-2024 xaboy
 * Github https://github.com/xaboy/form-create
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue"),require("vant")):"function"==typeof define&&define.amd?define(["exports","vue","vant"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).formCreateMobile={},e.Vue,e.vant)}(this,(function(e,t,n){"use strict";var r=t.defineComponent({name:"fcSubForm",props:{rule:Array,options:{type:Object,default:function(){return t.reactive({submitBtn:!1,resetBtn:!1})}},modelValue:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:!1},syncDisabled:{type:Boolean,default:!0},formCreateInject:Object},data:function(){return{cacheValue:{},subApi:{},form:t.markRaw(this.formCreateInject.form.$form())}},emits:["fc:subform","update:modelValue","change","itemMounted"],watch:{modelValue:function(e){this.setValue(e)}},methods:{formData:function(e){this.cacheValue=JSON.stringify(e),this.$emit("update:modelValue",e),this.$emit("change",e)},setValue:function(e){var t=JSON.stringify(e);this.cacheValue!==t&&(this.cacheValue=t,this.subApi.coverValue(e||{}))},add$f:function(e){var n=this;this.subApi=e,t.nextTick((function(){n.$emit("itemMounted",e)}))}},render:function(){var e=this.form;return t.createVNode(e,{disabled:this.disabled,"onUpdate:modelValue":this.formData,modelValue:this.modelValue,"onEmit-event":this.$emit,"onUpdate:api":this.add$f,rule:this.rule,option:this.options,extendOption:!0},null)}});function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function f(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=s(e);if(t){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}function p(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var m={type:function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},Undef:function(e){return null==e},Element:function(e){return"object"===a(e)&&null!==e&&1===e.nodeType&&!m.Object(e)},trueArray:function(e){return Array.isArray(e)&&e.length>0},Function:function(e){var t=this.getType(e);return"Function"===t||"AsyncFunction"===t},getType:function(e){var t=Object.prototype.toString.call(e);return/^\[object (.*)\]$/.exec(t)[1]},empty:function(e){return null==e||(!(!Array.isArray(e)||!Array.isArray(e)||e.length)||"string"==typeof e&&!e)}};function v(e,t){return{}.hasOwnProperty.call(e,t)}["Date","Object","String","Boolean","Array","Number"].forEach((function(e){m[e]=function(t){return m.type(t,e)}}));"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var g={exports:{}};!function(e,t){e.exports=function(){var e=1e3,t=6e4,n=36e5,r="millisecond",i="second",o="minute",u="hour",c="day",s="week",l="month",f="quarter",d="year",p="date",h="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},y=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},b={s:y,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+y(r,2,"0")+":"+y(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,l),o=n-i<0,a=t.clone().add(r+(o?-1:1),l);return+(-(r+(n-i)/(o?i-a:a-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:d,w:s,d:c,D:p,h:u,m:o,s:i,ms:r,Q:f}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},$="en",_={};_[$]=g;var w="$isDayjsObject",x=function(e){return e instanceof V||!(!e||!e[w])},C=function e(t,n,r){var i;if(!t)return $;if("string"==typeof t){var o=t.toLowerCase();_[o]&&(i=o),n&&(_[o]=n,i=o);var a=t.split("-");if(!i&&a.length>1)return e(a[0])}else{var u=t.name;_[u]=t,i=u}return!r&&i&&($=i),i||!r&&$},O=function(e,t){if(x(e))return e.clone();var n="object"==a(t)?t:{};return n.date=e,n.args=arguments,new V(n)},S=b;S.l=C,S.i=x,S.w=function(e,t){return O(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var V=function(){function a(e){this.$L=C(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[w]=!0}var g=a.prototype;return g.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(m);if(r){var i=r[2]-1||0,o=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)}}return new Date(t)}(e),this.init()},g.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},g.$utils=function(){return S},g.isValid=function(){return!(this.$d.toString()===h)},g.isSame=function(e,t){var n=O(e);return this.startOf(t)<=n&&n<=this.endOf(t)},g.isAfter=function(e,t){return O(e)<this.startOf(t)},g.isBefore=function(e,t){return this.endOf(t)<O(e)},g.$g=function(e,t,n){return S.u(e)?this[t]:this.set(n,e)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(e,t){var n=this,r=!!S.u(t)||t,a=S.p(e),f=function(e,t){var i=S.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?i:i.endOf(c)},h=function(e,t){return S.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},m=this.$W,v=this.$M,g=this.$D,y="set"+(this.$u?"UTC":"");switch(a){case d:return r?f(1,0):f(31,11);case l:return r?f(1,v):f(0,v+1);case s:var b=this.$locale().weekStart||0,$=(m<b?m+7:m)-b;return f(r?g-$:g+(6-$),v);case c:case p:return h(y+"Hours",0);case u:return h(y+"Minutes",1);case o:return h(y+"Seconds",2);case i:return h(y+"Milliseconds",3);default:return this.clone()}},g.endOf=function(e){return this.startOf(e,!1)},g.$set=function(e,t){var n,a=S.p(e),s="set"+(this.$u?"UTC":""),f=(n={},n[c]=s+"Date",n[p]=s+"Date",n[l]=s+"Month",n[d]=s+"FullYear",n[u]=s+"Hours",n[o]=s+"Minutes",n[i]=s+"Seconds",n[r]=s+"Milliseconds",n)[a],h=a===c?this.$D+(t-this.$W):t;if(a===l||a===d){var m=this.clone().set(p,1);m.$d[f](h),m.init(),this.$d=m.set(p,Math.min(this.$D,m.daysInMonth())).$d}else f&&this.$d[f](h);return this.init(),this},g.set=function(e,t){return this.clone().$set(e,t)},g.get=function(e){return this[S.p(e)]()},g.add=function(r,a){var f,p=this;r=Number(r);var h=S.p(a),m=function(e){var t=O(p);return S.w(t.date(t.date()+Math.round(e*r)),p)};if(h===l)return this.set(l,this.$M+r);if(h===d)return this.set(d,this.$y+r);if(h===c)return m(1);if(h===s)return m(7);var v=(f={},f[o]=t,f[u]=n,f[i]=e,f)[h]||1,g=this.$d.getTime()+r*v;return S.w(g,this)},g.subtract=function(e,t){return this.add(-1*e,t)},g.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=S.z(this),o=this.$H,a=this.$m,u=this.$M,c=n.weekdays,s=n.months,l=n.meridiem,f=function(e,n,i,o){return e&&(e[n]||e(t,r))||i[n].slice(0,o)},d=function(e){return S.s(o%12||12,e,"0")},p=l||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(v,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return S.s(t.$y,4,"0");case"M":return u+1;case"MM":return S.s(u+1,2,"0");case"MMM":return f(n.monthsShort,u,s,3);case"MMMM":return f(s,u);case"D":return t.$D;case"DD":return S.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return f(n.weekdaysMin,t.$W,c,2);case"ddd":return f(n.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(o);case"HH":return S.s(o,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return p(o,a,!0);case"A":return p(o,a,!1);case"m":return String(a);case"mm":return S.s(a,2,"0");case"s":return String(t.$s);case"ss":return S.s(t.$s,2,"0");case"SSS":return S.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(r,a,p){var h,m=this,v=S.p(a),g=O(r),y=(g.utcOffset()-this.utcOffset())*t,b=this-g,$=function(){return S.m(m,g)};switch(v){case d:h=$()/12;break;case l:h=$();break;case f:h=$()/3;break;case s:h=(b-y)/6048e5;break;case c:h=(b-y)/864e5;break;case u:h=b/n;break;case o:h=b/t;break;case i:h=b/e;break;default:h=b}return p?h:S.a(h)},g.daysInMonth=function(){return this.endOf(l).$D},g.$locale=function(){return _[this.$L]},g.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=C(e,t,!0);return r&&(n.$L=r),n},g.clone=function(){return S.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},a}(),k=V.prototype;return O.prototype=k,[["$ms",r],["$s",i],["$m",o],["$H",u],["$W",c],["$M",l],["$y",d],["$D",p]].forEach((function(e){k[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),O.extend=function(e,t){return e.$i||(e(t,V,O),e.$i=!0),O},O.locale=C,O.isDayjs=x,O.unix=function(e){return O(1e3*e)},O.en=_[$],O.Ls=_,O.p={},O}()}(g);var y=g.exports,b=t.defineComponent({name:"fcCalendar",inheritAttrs:!1,props:{placeholder:String,disabled:Boolean,clearable:Boolean,type:String,modelValue:[String,Array],minDate:[String,Date],maxDate:[String,Date]},emits:["update:modelValue","change","fc.el"],setup:function(e,n){var r=t.ref(!1),i=t.toRef(e,"modelValue"),o=t.ref(i.value);t.watch((function(){return i.value}),(function(e){o.value=e}));var a=function(e){return y(e).format("YYYY-MM-DD")},u=function(e){return y(e).toDate()},c=t.computed((function(){var e=i.value;return Array.isArray(e)?e.map(u):e?u(e):null})),s=t.computed((function(){return{minDate:e.minDate?y(e.minDate).toDate():void 0,maxDate:e.maxDate?y(e.maxDate).toDate():void 0}})),l=function(e){Array.isArray(e)?o.value=e.map(a):o.value=e?a(e):e},f=function(){n.emit("update:modelValue",o.value),n.emit("change",o.value)},d={range:function(){return o.value.length?o.value.join(" - "):""},multiple:function(){return o.value.length?"选择了 ".concat(o.value.length," 个日期"):""}};return{show:r,inputValue:o,defaultDate:c,dateRange:s,open:function(){e.disabled||(r.value=!0)},confirm:function(e){l(e),r.value=!1,f()},getStrValue:function(){return o.value?v(d,e.type)?d[e.type]():o.value||"":""},clear:function(e){e.stopPropagation();var t=Array.isArray(o.value)?[]:"";l(t),f()}}},render:function(){var e=this;return t.createVNode(t.Fragment,null,[t.createVNode(t.resolveComponent("van-field"),{ref:"el",placeholder:this.placeholder,readonly:!0,disabled:this.$props.disabled,onClick:this.open,"model-value":this.getStrValue(),isLink:!0,border:!1},{"right-icon":function(){return e.$props.clearable&&!m.empty(e.inputValue)?t.createVNode("i",{class:"van-badge__wrapper van-icon van-icon-clear van-field__clear",onClick:e.clear},null):void 0}}),t.createVNode(t.resolveComponent("van-calendar"),t.mergeProps(o(o({},this.$attrs),this.dateRange),{show:this.show,"onUpdate:show":function(t){return e.show=t},type:this.type,onConfirm:this.confirm,defaultDate:this.defaultDate}),null)])},mounted:function(){this.$emit("fc.el",this.$refs.el)}}),$=t.defineComponent({name:"fcCascader",inheritAttrs:!1,props:{placeholder:String,disabled:Boolean,clearable:Boolean,fieldNames:Object,modelValue:[String,Number],options:Array,minDate:[String,Date],maxDate:[String,Date]},emits:["update:modelValue","fc.el"],setup:function(e,n){var r=t.ref(!1),i=t.toRef(e,"modelValue"),o=t.toRef(e,"options"),a=t.toRef(e,"fieldNames",{}),u=function e(t,n,r){for(var i=0;i<t.length;i++){if(t[i][a.value.value||"value"]===n)return[].concat(p(r),[t[i]]);if(t[i][a.value.children||"children"]){var o=e(t[i][a.value.children||"children"],n,[].concat(p(r),[t[i]]));if(o)return o}}},c=function(e){if(null==e||""===e)return"";var t=u(o.value,e,[]);return t?t.map((function(e){return e[a.value.text||"text"]})).join(" / "):e},s=t.ref(c(i.value));t.watch((function(){return i.value}),(function(e){s.value=c(e)})),t.watch((function(){return o.value}),(function(){null!=i.value&&""!==i.value&&(s.value=c(i.value))}),{deep:!0});var l=function(e){n.emit("update:modelValue",e)};return{show:r,inputValue:s,options:o,open:function(){e.disabled||(r.value=!0)},confirm:function(e){var t=e.selectedOptions,n=e.value;s.value=t.map((function(e){return e[a.value.text||"text"]})).join(" / "),r.value=!1,l(n)},clear:function(e){e.stopPropagation(),s.value="",l("")}}},render:function(){var e=this;return t.createVNode(t.Fragment,null,[t.createVNode(t.resolveComponent("van-field"),{ref:"el",placeholder:this.placeholder,readonly:!0,disabled:this.$props.disabled,onClick:this.open,"model-value":this.inputValue,border:!1,isLink:!0},{"right-icon":function(){return e.$props.clearable&&e.inputValue?t.createVNode("i",{class:"van-badge__wrapper van-icon van-icon-clear van-field__clear",onClick:e.clear},null):void 0}}),t.createVNode(t.resolveComponent("van-popup"),{show:this.show,"onUpdate:show":function(t){return e.show=t},round:!0,position:"bottom"},{default:function(){return[t.createVNode(t.resolveComponent("van-cascader"),t.mergeProps(e.$attrs,{modelValue:e.modelValue,fieldNames:e.fieldNames,options:e.options,onClose:function(){return e.show=!1},onFinish:e.confirm}),null)]}})])},mounted:function(){this.$emit("fc.el",this.$refs.el)}});var _=t.defineComponent({name:"fcCheckbox",inheritAttrs:!1,props:{modelValue:Array,options:Array},emits:["update:modelValue"],setup:function(e,n){var r=t.toRef(e,"modelValue",[]);return{options:t.toRef(e,"options"),modelValue:r,onInput:function(e){n.emit("update:modelValue",e)}}},render:function(){var e,n;return t.createVNode(t.resolveComponent("van-checkbox-group"),t.mergeProps({direction:"horizontal"},this.$attrs,{modelValue:Array.isArray(this.modelValue)?this.modelValue:[],"onUpdate:modelValue":this.onInput}),"function"==typeof(n=e=(this.options||[]).map((function(e){var n=o({},e),r=e.text,i=e.value;return delete n.text,delete n.value,t.createVNode(t.resolveComponent("van-checkbox"),t.mergeProps({name:i,shape:"square"},n),{default:function(){return[r||e.label||i]}})})))||"[object Object]"===Object.prototype.toString.call(n)&&!t.isVNode(n)?e:{default:function(){return[e]}})}}),w=t.defineComponent({name:"fcSelect",inheritAttrs:!1,props:{disabled:Boolean,placeholder:String,columnsFieldNames:Object,modelValue:[String,Number],options:Array},emits:["update:modelValue","fc.el"],setup:function(e,n){var r=t.ref(!1),i=t.toRef(e,"modelValue"),o=t.toRef(e,"options"),a=t.toRef(e,"columnsFieldNames",{}),u=t.computed((function(){if(null==i.value||""===i.value)return"";for(var e=0;e<(o.value||[]).length;e++)if(o.value[e][a.value.value||"value"]===i.value)return o.value[e][a.value.text||"text"];return i.value}));return{show:r,inputValue:u,options:o,open:function(){e.disabled||(r.value=!0)},confirm:function(e){var t,i=e.selectedValues;t=i[0],n.emit("update:modelValue",t),r.value=!1}}},render:function(){var e=this;return t.createVNode(t.Fragment,null,[t.createVNode(t.resolveComponent("van-field"),{ref:"el",placeholder:this.placeholder,readonly:!0,disabled:this.$props.disabled,onClick:this.open,"model-value":this.inputValue,isLink:!0},null),t.createVNode(t.resolveComponent("van-popup"),{show:this.show,"onUpdate:show":function(t){return e.show=t},round:!0,position:"bottom"},{default:function(){return[t.createVNode(t.resolveComponent("van-picker"),t.mergeProps(e.$attrs,{modelValue:[e.modelValue],columnsFieldNames:e.columnsFieldNames,columns:e.options,onCancel:function(){return e.show=!1},onConfirm:e.confirm}),null)]}})])},mounted:function(){this.$emit("fc.el",this.$refs.el)}});function x(e){return Array.isArray(e)?e:[null,void 0,""].indexOf(e)>-1?[]:[e]}function C(e,t){return"object"===a(e)?e:{url:e,is_string:!0,name:S(e),uid:t}}function O(e){return o(o({},e),{},{file:e,value:e})}function S(e){return(""+e).split("/").pop()}var V=t.defineComponent({name:"fcUploader",inheritAttrs:!1,props:{formCreateInject:Object,modelValue:Array,afterRead:Function,action:String,headers:Object,method:String,data:Object,uploadName:String,onSuccess:Function,onError:Function,maxCount:Number},emits:["update:modelValue","delete"],setup:function(e,n){var r=t.toRef(e,"afterRead"),i=t.toRef(e,"modelValue",[]),o=t.ref(x(i.value).map(C).map(O));t.watch((function(){return i.value}),(function(e){o.value=x(e).map(C).map(O)}));var a=function(){var t=o.value.map((function(e){return e.is_string?e.url:e.value||e.url})).filter((function(e){return void 0!==e}));n.emit("update:modelValue",1===e.maxCount?t[0]||"":t)};return{fileList:o,modelValue:i,onDelete:function(e){a(),n.emit("delete",e)},uploadFile:function(t){if(t.status="uploading",r.value)return r.value(t);var n=e.data||{};n[e.uploadName||"file"]=t.file,e.formCreateInject.api.fetch({action:e.action,dataType:"formData",source:"upload",headers:e.headers||{},method:e.method||"post",data:n}).then((function(n){t.status="success",e.onSuccess&&e.onSuccess(n,t),a()})).catch((function(n){t.status="failed",t.message="上传失败",e.onError&&e.onError(n,t)}))}}},render:function(){var e=this;return t.createVNode(t.resolveComponent("van-uploader"),t.mergeProps(this.$attrs,{"model-value":this.fileList,"onUpdate:model-value":function(t){return e.fileList=t},afterRead:this.uploadFile,onDelete:this.onDelete}),null)}});var k=t.defineComponent({name:"fcRadio",inheritAttrs:!1,props:{modelValue:[String,Number],options:Array},emits:["update:modelValue"],setup:function(e,n){var r=t.toRef(e,"modelValue",[]);return{options:t.toRef(e,"options"),modelValue:r,onInput:function(e){n.emit("update:modelValue",e)}}},render:function(){var e,n;return t.createVNode(t.resolveComponent("van-radio-group"),t.mergeProps({direction:"horizontal"},this.$attrs,{modelValue:this.modelValue,"onUpdate:modelValue":this.onInput}),"function"==typeof(n=e=(this.options||[]).map((function(e){var n=o({},e),r=e.text,i=e.value;return delete n.text,delete n.value,t.createVNode(t.resolveComponent("van-radio"),t.mergeProps({name:i},n),{default:function(){return[r||e.label||i]}})})))||"[object Object]"===Object.prototype.toString.call(n)&&!t.isVNode(n)?e:{default:function(){return[e]}})}}),D=t.defineComponent({name:"fcDatePicker",inheritAttrs:!1,props:{disabled:Boolean,clearable:Boolean,placeholder:String,modelValue:[String,Number],minDate:[String,Date],maxDate:[String,Date]},emits:["update:modelValue","fc.el"],setup:function(e,n){var r=t.ref(!1),i=t.toRef(e,"modelValue"),o=t.computed((function(){return null==i.value||""===i.value?[]:i.value.split("-")})),a=t.computed((function(){return{minDate:e.minDate?y(e.minDate).toDate():void 0,maxDate:e.maxDate?y(e.maxDate).toDate():void 0}})),u=function(e){n.emit("update:modelValue",e)};return{show:r,formValue:o,dateRange:a,open:function(){e.disabled||(r.value=!0)},confirm:function(e){var t=e.selectedValues;u(t.join("-")),r.value=!1},clear:function(e){e.stopPropagation(),u("")}}},render:function(){var e=this;return t.createVNode(t.Fragment,null,[t.createVNode(t.resolveComponent("van-field"),{ref:"el",placeholder:this.placeholder,readonly:!0,disabled:this.$props.disabled,onClick:this.open,"model-value":this.modelValue,border:!1,isLink:!0},{"right-icon":function(){return e.$props.clearable&&e.modelValue?t.createVNode("i",{class:"van-badge__wrapper van-icon van-icon-clear van-field__clear",onClick:e.clear},null):void 0}}),t.createVNode(t.resolveComponent("van-popup"),{show:this.show,"onUpdate:show":function(t){return e.show=t},round:!0,position:"bottom"},{default:function(){return[t.createVNode(t.resolveComponent("van-date-picker"),t.mergeProps({columnsType:["year","month","day"]},o(o({},e.$attrs),e.dateRange),{modelValue:e.formValue,onConfirm:e.confirm,onCancel:function(){return e.show=!1}}),null)]}})])},mounted:function(){this.$emit("fc.el",this.$refs.el)}}),j=t.defineComponent({name:"fcTimePicker",inheritAttrs:!1,props:{disabled:Boolean,clearable:Boolean,placeholder:String,modelValue:[String,Number]},emits:["update:modelValue","fc.el"],setup:function(e,n){var r=t.ref(!1),i=t.toRef(e,"modelValue"),o=t.computed((function(){return null==i.value||""===i.value?[]:i.value.split(":")})),a=function(e){n.emit("update:modelValue",e)};return{show:r,formValue:o,open:function(){e.disabled||(r.value=!0)},confirm:function(e){var t=e.selectedValues;a(t.join(":")),r.value=!1},clear:function(e){e.stopPropagation(),a("")}}},render:function(){var e=this;return t.createVNode(t.Fragment,null,[t.createVNode(t.resolveComponent("van-field"),{ref:"el",placeholder:this.placeholder,readonly:!0,disabled:this.$props.disabled,onClick:this.open,"model-value":this.modelValue,border:!1,isLink:!0},{"right-icon":function(){return e.$props.clearable&&e.modelValue?t.createVNode("i",{class:"van-badge__wrapper van-icon van-icon-clear van-field__clear",onClick:e.clear},null):void 0}}),t.createVNode(t.resolveComponent("van-popup"),{show:this.show,"onUpdate:show":function(t){return e.show=t},round:!0,position:"bottom"},{default:function(){return[t.createVNode(t.resolveComponent("van-time-picker"),t.mergeProps({columnsType:["hour","minute"]},e.$attrs,{modelValue:e.formValue,onConfirm:e.confirm,onCancel:function(){return e.show=!1}}),null)]}})])},mounted:function(){this.$emit("fc.el",this.$refs.el)}});function F(e,t,n){e[t]=n}function R(e,t){delete e[t]}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=!1;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var o=t[i];if((r=Array.isArray(o))||m.Object(o)){var a=void 0===e[i];if(r)r=!1,a&&F(e,i,[]);else if(o._clone&&void 0!==n){if(!n){F(e,i,o._clone());continue}o=o.getRule(),a&&F(e,i,{})}else a&&F(e,i,{});e[i]=E(e[i],o,n)}else F(e,i,o),m.Undef(o)||(m.Undef(o.__json)||(e[i].__json=o.__json),m.Undef(o.__origin)||(e[i].__origin=o.__origin))}return void 0!==n&&Array.isArray(e)?e.filter((function(e){return!e||!e.__ctrl})):e}function A(e){return E({},{value:e}).value}var P=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&F(e,r,t[r]);return e};function N(){return P.apply(this,arguments)}function T(e){return"object"!==a(e)||null===e?e:e instanceof Array?p(e):o({},e)}var M=t.defineComponent({name:"fcGroup",props:{field:String,rule:Array,expand:Number,options:Object,button:{type:Boolean,default:!0},max:{type:Number,default:0},min:{type:Number,default:0},modelValue:{type:Array,default:function(){return[]}},defaultValue:Object,sortBtn:{type:Boolean,default:!1},disabled:{type:Boolean,default:void 0},onBeforeRemove:{type:Function,default:function(){}},onBeforeAdd:{type:Function,default:function(){}},formCreateInject:Object,parse:Function},data:function(){return{len:0,cacheRule:{},cacheValue:{},sort:[],form:t.markRaw(this.formCreateInject.form.$form())}},emits:["update:modelValue","change","itemMounted","remove","add"],watch:{rule:{handler:function(e,t){var n=this;Object.keys(this.cacheRule).forEach((function(r){var i=n.cacheRule[r];if(i.$f){var o=i.$f.formData();if(e===t)i.$f.deferSyncValue((function(){E(i.rule,e),i.$f.setValue(o)}),!0);else{var a=i.$f.formData();i.$f.once("reloading",(function(){i.$f.setValue(a)})),i.rule=A(e)}}}))},deep:!0},expand:function(e){var t=e-this.modelValue.length;t>0&&this.expandRule(t)},modelValue:{handler:function(e){var t=this;e=e||[];var n=Object.keys(this.sort),r=n.length,i=r-e.length;if(i<0){for(var o=i;o<0;o++)this.addRule(e.length+o,!0);for(var a=0;a<r;a++)this.setValue(n[a],e[a])}else{if(i>0)for(var u=0;u<i;u++)this.removeRule(n[r-u-1]);e.forEach((function(r,i){t.setValue(n[i],e[i])}))}},deep:!0}},methods:{_value:function(e){return e&&v(e,this.field)?e[this.field]:e},cache:function(e,t){this.cacheValue[e]=JSON.stringify(t)},input:function(e){this.$emit("update:modelValue",e),this.$emit("change",e)},formData:function(e,t){var n=this,r=this.cacheRule,i=this.sort;if(i.filter((function(e){return r[e].$f})).length===i.length){var a=i.map((function(r){var i=e===r?t:o({},n.cacheRule[r].$f.form),a=n.field?i[n.field]||null:i;return n.cache(r,a),a}));this.input(a)}},setValue:function(e,t){var n=this.field;n&&(t=c({},n,this._value(t))),this.cacheValue[e]!==JSON.stringify(n?t[n]:t)&&this.cache(e,t)},addRule:function(e,n){var r=this,i=this.formCreateInject.form.copyRules(this.rule||[]),a=this.options?o({},this.options):{submitBtn:!1,resetBtn:!1};if(this.defaultValue){a.formData||(a.formData={});var u=A(this.defaultValue);N(a.formData,this.field?c({},this.field,u):u)}this.parse&&this.parse({rule:i,options:a,index:this.sort.length}),this.cacheRule[++this.len]={rule:i,options:a},n&&t.nextTick((function(){return r.$emit("add",i,Object.keys(r.cacheRule).length-1)}))},add$f:function(e,n,r){var i=this;this.cacheRule[n].$f=r,t.nextTick((function(){i.$emit("itemMounted",r,Object.keys(i.cacheRule).indexOf(n))}))},removeRule:function(e,n){var r=this,i=Object.keys(this.cacheRule).indexOf(e);delete this.cacheRule[e],delete this.cacheValue[e],n&&t.nextTick((function(){return r.$emit("remove",i)}))},add:function(e){if(!this.disabled&&!1!==this.onBeforeAdd(this.modelValue)){var t=p(this.modelValue);t.push(this.defaultValue?A(this.defaultValue):this.field?null:{}),this.input(t)}},del:function(e,t){if(!this.disabled&&!1!==this.onBeforeRemove(this.modelValue,e)){this.removeRule(t,!0);var n=p(this.modelValue);n.splice(e,1),this.input(n)}},addIcon:function(e){return t.createVNode("div",{class:"_fc-m-group-btn _fc-m-group-plus-minus",onClick:this.add},null)},delIcon:function(e,n){var r=this;return t.createVNode("div",{class:"_fc-m-group-btn _fc-m-group-plus-minus _fc-m-group-minus",onClick:function(){return r.del(e,n)}},null)},sortUpIcon:function(e){var n=this;return t.createVNode("div",{class:"_fc-m-group-btn _fc-m-group-arrow _fc-m-group-up",onClick:function(){return n.changeSort(e,-1)}},null)},sortDownIcon:function(e){var n=this;return t.createVNode("div",{class:"_fc-m-group-btn _fc-m-group-arrow _fc-m-group-down",onClick:function(){return n.changeSort(e,1)}},null)},changeSort:function(e,t){var n=this,r=this.sort[e];this.sort[e]=this.sort[e+t],this.sort[e+t]=r,this.formCreateInject.subForm(this.sort.map((function(e){return n.cacheRule[e].$f}))),this.formData(0)},makeIcon:function(e,t,n){var r=this;if(this.$slots.button)return this.$slots.button({total:e,index:t,vm:this,key:n,del:function(){return r.del(t,n)},add:this.add});var i=[];return(!this.max||e<this.max)&&e===t+1&&i.push(this.addIcon(n)),e>this.min&&i.push(this.delIcon(t,n)),this.sortBtn&&t&&i.push(this.sortUpIcon(t)),this.sortBtn&&t!==e-1&&i.push(this.sortDownIcon(t)),i},emitEvent:function(e,t,n,r){this.$emit.apply(this,[e].concat(p(t),[this.cacheRule[r].$f,n]))},expandRule:function(e){for(var t=0;t<e;t++)this.addRule(t)}},created:function(){var e=this;t.watch((function(){return o({},e.cacheRule)}),(function(t){e.sort=Object.keys(t)}),{immediate:!0});for(var n=(this.expand||0)-this.modelValue.length,r=0;r<this.modelValue.length;r++)this.addRule(r);n>0&&this.expandRule(n)},render:function(){var e=this,n=this.sort,r=this.button,i=this.form,o=this.$props.disabled,a=0===n.length?this.$slots.default?this.$slots.default({vm:this,add:this.add}):t.createVNode("div",{key:"a_def",class:"_fc-m-group-plus-minus _fc-m-group-add fc-clock",onClick:this.add},null):n.map((function(a,u){var s=e.cacheRule[a],l=s.rule,f=s.options,d=r&&!o?e.makeIcon(n.length,u,a):[];return t.createVNode("div",{class:"_fc-m-group-container",key:a},[t.createVNode(i,t.mergeProps({key:a},{disabled:o,"onUpdate:modelValue":function(t){return e.formData(a,t)},"onEmit-event":function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return e.emitEvent(t,r,u,a)},"onUpdate:api":function(t){return e.add$f(u,a,t)},inFor:!0,modelValue:e.field?c({},e.field,e._value(e.modelValue[u])):e.modelValue[u],rule:l,option:f,extendOption:!0}),null),t.createVNode("div",{class:"_fc-m-group-idx"},[u+1]),d.length?t.createVNode("div",{class:"_fc-m-group-handle fc-clock"},[d]):null])}));return t.createVNode("div",{key:"con",class:"_fc-m-group "+(o?"_fc-m-group-disabled":"")},[a])}}),B={name:"IconWarning"},I={class:"icon",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},L=[t.createElementVNode("path",{fill:"currentColor",d:"M512 64a448 448 0 110 896 448 448 0 010-896zm0 832a384 384 0 000-768 384 384 0 000 768zm48-176a48 48 0 11-96 0 48 48 0 0196 0zm-48-464a32 32 0 0132 32v288a32 32 0 01-64 0V288a32 32 0 0132-32z"},null,-1)];B.render=function(e,n,r,i,o,a){return t.openBlock(),t.createElementBlock("svg",I,L)};var U=[r,B,b,$,_,k,w,D,j,M,V];function J(e,t){var n=null;return function(){for(var r=this,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];null!==n&&clearTimeout(n),n=setTimeout((function(){return e.call.apply(e,[r].concat(o))}),t)}}function q(e){var t=e.replace(/([A-Z])/g,"-$1").toLocaleLowerCase();return 0===t.indexOf("-")&&(t=t.substr(1)),t}var W=function(e,t){if(e&&e!==t)return e.props.formCreateInject?e.props.formCreateInject:e.parent?W(e.parent,t):void 0};function H(e,n,r){return t.defineComponent({name:"FormCreate"+(e.isMobile?"Mobile":""),components:n,directives:r,props:{rule:{type:Array,required:!0,default:function(){return[]}},option:{type:Object,default:function(){return{}}},extendOption:Boolean,driver:[String,Object],modelValue:Object,disabled:{type:Boolean,default:void 0},preview:{type:Boolean,default:void 0},index:[String,Number],api:Object,name:String,subForm:{type:Boolean,default:!0},inFor:Boolean},emits:["update:api","update:modelValue","mounted","submit","reset","change","emit-event","control","remove-rule","remove-field","sync","reload","repeat-field","update","validate-field-fail","validate-fail","created"],render:function(){return this.fc.render()},setup:function(n){var r=t.getCurrentInstance();t.provide("parentFC",r);var i=t.inject("parentFC",null),a=i;if(i)for(;a.setupState.parent;)a=a.setupState.parent;else a=r;var u=t.toRefs(n),c=u.rule,s=u.modelValue,l=u.subForm,f=u.inFor,d=t.reactive({ctxInject:{},destroyed:!1,isShow:!0,unique:1,renderRule:p(c.value||[]),updateValue:JSON.stringify(s.value||{})}),h=new e(r),m=h.api(),v=f.value,g=function(){var e=W(r,i);if(e)if(v){var t=x(e.getSubForm()),n=t.indexOf(m);n>-1&&t.splice(n,1)}else e.subForm()},y=null;t.onBeforeMount((function(){t.watchEffect((function(){var e="",t=n.option&&n.option.globalClass||{};Object.keys(t).forEach((function(n){var r="";t[n].style&&Object.keys(t[n].style).forEach((function(e){r+=q(e)+":"+t[n].style[e]+";"})),t[n].content&&(r+=t[n].content+";"),r&&(e+=".".concat(n,"{").concat(r,"}"))})),n.option&&n.option.style&&(e+=n.option.style),y||((y=document.createElement("style")).type="text/css",document.head.appendChild(y)),y.innerHTML=e||""}))}));var b=J((function(){h.bus.$emit("$loadData.$topForm")}),100),$=J((function(){h.bus.$emit("$loadData.$form")}),100),_=function(e){h.bus.$emit("change-$form."+e)};return t.onMounted((function(){i&&(m.top.bus.$on("$loadData.$form",b),m.top.bus.$on("change",_)),h.mounted()})),t.onBeforeUnmount((function(){i&&(m.top.bus.$off("$loadData.$form",b),m.top.bus.$off("change",_)),y&&document.head.removeChild(y),g(),d.destroyed=!0,h.unmount()})),t.onUpdated((function(){h.updated()})),t.watch(l,(function(e){e?function(){if(i){var e,t=W(r,i);t&&(v?(e=x(t.getSubForm())).push(m):e=m,t.subForm(e))}}():g()}),{immediate:!0}),t.watch((function(){return p(c.value)}),(function(e){h.$handle.isBreakWatch()||e.length===d.renderRule.length&&e.every((function(e){return d.renderRule.indexOf(e)>-1}))||(h.$handle.updateAppendData(),h.$handle.reloadRule(c.value),r.setupState.renderRule())})),t.watch((function(){return n.option}),(function(){h.initOptions(),m.refresh()}),{deep:!0}),t.watch((function(){return[n.disabled,n.preview]}),(function(){m.refresh()})),t.watch(s,(function(e){JSON.stringify(e||{})!==d.updateValue&&(m.config.forceCoverValue?m.coverValue(e||{}):m.setValue(e||{}))}),{deep:!0,flush:"post"}),t.watch((function(){return n.index}),(function(){m.coverValue({}),h.$handle.updateAppendData(),t.nextTick((function(){t.nextTick((function(){m.clearValidateState()}))}))}),{flush:"sync"}),o(o({fc:t.markRaw(h),parent:i?t.markRaw(i):i,top:t.markRaw(a),fapi:t.markRaw(m)},t.toRefs(d)),{},{getGroupInject:function(){return W(r,i)},refresh:function(){++d.unique},renderRule:function(){d.renderRule=p(c.value||[])},updateValue:function(e){if(!d.destroyed){var n=JSON.stringify(e);d.updateValue!==n&&(d.updateValue=n,r.emit("update:modelValue",e),t.nextTick((function(){$(),i||b()})))}}})},created:function(){var e=t.getCurrentInstance();e.emit("update:api",e.setupState.fapi),e.setupState.fc.init()}})}var G=["props"],Y=["class","style","directives"],z=["on"],K=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[].concat(G,p(r.normal||[])),u=[].concat(Y,p(r.array||[])),c=[].concat(z,p(r.functional||[])),s=r.props||[];return t.reduce((function(t,n){for(var r in n)if(t[r])if(s.indexOf(r)>-1)t[r]=e([n[r]],t[r]);else if(i.indexOf(r)>-1)t[r]=o(o({},t[r]),n[r]);else if(u.indexOf(r)>-1){var l=t[r]instanceof Array?t[r]:[t[r]],f=n[r]instanceof Array?n[r]:[n[r]];t[r]=[].concat(p(l),p(f))}else if(c.indexOf(r)>-1)for(var d in n[r])if(t[r][d]){var h=t[r][d]instanceof Array?t[r][d]:[t[r][d]],m=n[r][d]instanceof Array?n[r][d]:[n[r][d]];t[r][d]=[].concat(p(h),p(m))}else t[r][d]=n[r][d];else if("hook"===r)for(var v in n[r])t[r][v]?t[r][v]=X(t[r][v],n[r][v]):t[r][v]=n[r][v];else t[r]=n[r];else i.indexOf(r)>-1||c.indexOf(r)>-1||s.indexOf(r)>-1?t[r]=o({},n[r]):u.indexOf(r)>-1?t[r]=n[r]instanceof Array?p(n[r]):"object"===a(n[r])?o({},n[r]):n[r]:t[r]=n[r];return t}),n)},X=function(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}},Z=["type","slot","ignore","emitPrefix","value","name","native","hidden","display","inject","options","emit","link","prefix","suffix","update","sync","optionsTo","key","slotUpdate","computed","preview","component","cache","modelEmit"],Q=["validate","children","control"],ee=["effect","deep"];function te(){return[].concat(Z,p(G),p(Y),p(z),Q,ee)}function ne(e,t,n){return"[form-create ".concat(e,"]: ").concat(t)+(n?"\n\nrule: "+JSON.stringify(n.getRule?n.getRule():n):"")}function re(e,t){console.error(ne("err",e,t))}function ie(e){return oe(e.replace(/(-[a-z])/g,(function(e){return e.replace("-","").toLocaleUpperCase()})))}function oe(e){return e.replace(e[0],e[0].toLowerCase())}var ae="[[FORM-CREATE-PREFIX-",ue="-FORM-CREATE-SUFFIX]]",ce="$FN:",se="$FNX:",le="$GLOBAL:",fe="function";function de(e,t){return JSON.stringify(E(Array.isArray(e)?[]:{},e,!0),(function(e,t){if(!t||!0!==t._isVue){if(a(t)!==fe)return t;if(t.__json)return t.__json;if(t.__origin&&(t=t.__origin),!t.__emit)return ae+t+ue}}),t)}function pe(e){return new Function("return "+e)()}function he(e,t){if(e&&m.String(e)&&e.length>4){var n=e.trim(),r=!1;try{if(n.indexOf(ue)>0&&0===n.indexOf(ae))n=n.replace(ue,"").replace(ae,""),r=!0;else if(0===n.indexOf(ce))n=n.replace(ce,""),r=!0;else{if(0===n.indexOf(le)){var i=n.replace(le,"");return n=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0].api.getGlobalEvent(i);if(r)return r.call.apply(r,[this].concat(t))},n.__json=e,n.__inject=!0,n}if(0===n.indexOf(se))return(n=pe("function($inject){"+n.replace(se,"")+"}")).__json=e,n.__inject=!0,n;t||0!==n.indexOf(fe)||n===fe||(r=!0)}if(!r)return e;var o=pe(-1===n.indexOf(fe)&&0!==n.indexOf("(")?"function "+n:n);return o.__json=e,o}catch(e){return void re("解析失败:".concat(n,"\n\nerr: ").concat(e))}}return e}function me(e,t){return JSON.parse(e,(function(e,n){return m.Undef(n)||!n.indexOf?n:he(n,t)}))}function ve(e,t){return{value:e,enumerable:!1,configurable:!1,writable:!!t}}function ge(e,t){return ye([e],t||!1)[0]}function ye(e,t){return E([],p(e),t||!1)}function be(e,t){return K(Array.isArray(t)?t:[t],e,{array:Q,normal:ee}),e}function $e(e){var t=m.Function(e.getRule)?e.getRule():e;return t.type||(t.type="input"),t}function _e(e,t){Object.defineProperties(e,Object.keys(t).reduce((function(e,n){return e[n]={get:function(){return t[n]()}},e}),{}))}function we(e){return e.__fc__||(e.__origin__?e.__origin__.__fc__:null)}function xe(e,t){try{t=e()}catch(e){!function(e){re(e.toString()),console.error(e)}(e)}return t}function Ce(){var e={},n=function(e){return e||"default"};return{setSlot:function(t,r){t=n(t),!r||Array.isArray(r)&&r.length||(e[t]||(e[t]=[]),e[t].push(r))},getSlot:function(t,r){t=n(t);var i=[];return(e[t]||[]).forEach((function(e){if(Array.isArray(e))i.push.apply(i,p(e));else if(m.Function(e)){var t=e.apply(void 0,p(r||[]));Array.isArray(t)?i.push.apply(i,p(t)):i.push(t)}else m.Undef(e)||i.push(e)})),i},getSlots:function(){var t=this,n={};return Object.keys(e).forEach((function(e){n[e]=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return t.getSlot(e,r)}})),n},slotLen:function(t){return t=n(t),e[t]?e[t].length:0},mergeBag:function(e){var n=this;if(!e)return this;var r=m.Function(e.getSlots)?e.getSlots():e;return Array.isArray(e)||t.isVNode(e)?this.setSlot(void 0,(function(){return e})):Object.keys(r).forEach((function(e){n.setSlot(e,r[e])})),this}}}function Oe(e){var t=o({},e.props||{});return Object.keys(e.on||{}).forEach((function(n){n.indexOf("-")>0&&(n=ie(n));var r,i="on".concat((r=n).replace(r[0],r[0].toLocaleUpperCase()));Array.isArray(t[i])?t[i]=[].concat(p(t[i]),[e.on[n]]):t[i]?t[i]=[t[i],e.on[n]]:t[i]=e.on[n]})),t.key=e.key,t.ref=e.ref,t.class=e.class,t.id=e.id,t.style=e.style,t.slot&&delete t.slot,t}function Se(e,t){return Object.setPrototypeOf(e,t),e}var Ve=function(e,t){return"string"==typeof e?String(t):"number"==typeof e?Number(t):t},ke={"==":function(e,t){return JSON.stringify(e)===JSON.stringify(Ve(e,t))},"!=":function(e,t){return!ke["=="](e,t)},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},on:function(e,t){return e&&e.indexOf&&e.indexOf(Ve(e[0],t))>-1},notOn:function(e,t){return!ke.on(e,t)},in:function(e,t){return t&&t.indexOf&&t.indexOf(e)>-1},notIn:function(e,t){return!ke.in(e,t)},between:function(e,t){return e>t[0]&&e<t[1]},notBetween:function(e,t){return e<t[0]||e>t[1]},empty:function(e){return m.empty(e)},notEmpty:function(e){return!m.empty(e)},pattern:function(e,t){return new RegExp(t,"g").test(e)}};function De(e,t){return(Array.isArray(t)?t:(t||"").split(".")).forEach((function(t){null!=e&&(e=e[t])})),e}function je(e,t){return function(n,r,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=new Fe(e,n,r,i,o);return t&&(m.Function(t)?t(a):a.props(t)),a}}function Fe(e,t,n,r,i){this._data=N({props:{},on:{},options:[],children:[],hidden:!1,display:!0,value:void 0},{type:e,title:t,field:n,value:r,props:i||{}}),this.event=this.on}function Re(e){e.forEach((function(e){Fe.prototype[e]=function(t){return be(this._data,c({},e,arguments.length<2?t:c({},t,arguments[1]))),this}}))}N(Fe.prototype,{getRule:function(){return this._data},setProp:function(e,t){return F(this._data,e,t),this},modelField:function(e){return this._data.modelField=e,this},_clone:function(){var e=new this.constructor;return e._data=ge(this._data),e}}),Re(te());var Ee=je("");function Ae(e,t,n){var r=Ee("",t);return r._data.type=e,r._data.title=n,r}function Pe(){return{create:Ae,factory:je}}function Ne(e){var t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(e){return t}}function Te(e){if("undefined"!=typeof XMLHttpRequest){var t,n=new XMLHttpRequest,r=e.action;n.onerror=function(t){e.onError(t)},n.onload=function(){if(n.status<200||n.status>=300)return e.onError(function(e,t,n){var r="fail to ".concat(e," ").concat(n.status,"'"),i=new Error(r);return i.status=n.status,i.url=e,i}(r,0,n),Ne(n));e.onSuccess(Ne(n))},n.open(e.method||"get",r,!0),e.data&&("json"!==(e.dataType||"").toLowerCase()?(t=new FormData,Object.keys(e.data).map((function(n){t.append(n,e.data[n])}))):(t=JSON.stringify(e.data),n.setRequestHeader("content-type","application/json"))),e.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);var i=e.headers||{};Object.keys(i).forEach((function(e){null!=i[e]&&n.setRequestHeader(e,i[e])})),n.send(t)}}function Me(e,t){return new Promise((function(n,r){(t||Te)(o(o({},e),{},{onSuccess:function(t){var r=function(e){return e},i=he(e.parse);m.Function(i)?r=i:i&&m.String(i)&&(r=function(e){return De(e,i)}),n(r(t))},onError:function(e){r(e)}}))}))}function Be(e){return A(e)}var Ie=0;function Le(){var e=370+ ++Ie;return"F"+Math.random().toString(36).substr(3,3)+Number("".concat(Date.now())).toString(36)+e.toString(36)+"c"}function Ue(e,t,n){var r,i=e;return(t||"").split(".").forEach((function(e){r&&(i[r]&&"object"==a(i[r])||(i[r]={}),i=i[r]),r=e})),i[r]=n,i}var Je=1;function qe(e){N(this,{$handle:e,fc:e.fc,vm:e.vm,$manager:e.$manager,vNode:new e.fc.CreateNode(e.vm),id:Je++}),_e(this,{options:function(){return e.options},sort:function(){return e.sort}}),this.initCache(),this.initRender()}!function(e){N(e.prototype,{initCache:function(){this.clearCacheAll()},clearCache:function(e){e.rule.cache||(this.cache[e.id]?((!0===this.cache[e.id].use||this.cache[e.id].parent)&&this.$handle.refresh(),this.cache[e.id].parent&&this.clearCache(this.cache[e.id].parent),this.cache[e.id]=null):e.parent&&this.clearCache(e.parent))},clearCacheAll:function(){this.cache={}},setCache:function(e,t,n){this.cache[e.id]={vnode:t,use:!1,parent:n,slot:e.rule.slot}},getCache:function(e){var t=this.cache[e.id];if(t)return t.use=!0,t.vnode}})}(qe),function(e){N(e.prototype,{initRender:function(){this.cacheConfig={}},getTypeSlot:function(e){return function t(n){if(n){var r=void 0;return e.rule.field&&(r=n.slots["field-"+q(e.rule.field)]||n.slots["field-"+e.rule.field]),r||(r=n.slots["type-"+q(e.type)]||n.slots["type-"+e.type]),r||t(n.setupState.parent)}}(this.vm)},render:function(){var e=this;if(this.vm.setupState.isShow){this.$manager.beforeRender();var t=Ce();return this.sort.forEach((function(n){e.renderSlot(t,e.$handle.ctxs[n])})),this.$manager.render(t)}},renderSlot:function(e,t,n){if(this.isFragment(t)){t.initProp(),this.mergeGlobal(t),t.initNone();var r=this.renderChildren(t.loadChildrenPending(),t),i=r.default;i&&e.setSlot(t.rule.slot,(function(){return i()})),delete r.default,e.mergeBag(r)}else e.setSlot(t.rule.slot,this.renderCtx(t,n))},mergeGlobal:function(e){var n=this;this.$handle.options.global&&(this.cacheConfig[e.trueType]||(this.cacheConfig[e.trueType]=t.computed((function(){var t=n.$handle.options.global;return be({},[t["*"],t[e.originType]||t[e.type]||t[e.type]||{}])}))),e.prop=be({},[this.cacheConfig[e.trueType].value,e.prop]))},setOptions:function(e){var t=e.loadPending({key:"options",origin:e.prop.options,def:[]});e.prop.options=t,e.prop.optionsTo&&t&&Ue(e.prop,e.prop.optionsTo,t)},deepSet:function(e){var t=e.rule.deep;t&&Object.keys(t).sort((function(e,t){return e.length<t.length?-1:1})).forEach((function(n){Ue(e.prop,n,t[n])}))},parseSide:function(e,t){return m.Object(e)?be({props:{formCreateInject:t.prop.props.formCreateInject}},e):e},renderSides:function(e,t,n){var r=t[n?"rule":"prop"];return[this.renderRule(this.parseSide(r.prefix,t)),e,this.renderRule(this.parseSide(r.suffix,t))]},renderId:function(e,t){var n=this,r=this.$handle["field"===t?"fieldCtx":"nameCtx"][e];return r?r.map((function(e){return n.renderCtx(e,e.parent)})):void 0},renderCtx:function(e,t){var n=this;try{if("hidden"===e.type)return;var r=e.rule;if(!this.cache[e.id]||this.cache[e.id].slot!==r.slot){var i;e.initProp(),this.mergeGlobal(e),e.initNone(),this.$manager.tidyRule(e),this.deepSet(e),this.setOptions(e),this.ctxProp(e);var o=e.prop;o.preview=!!(null!=o.preview?o.preview:this.$handle.preview),o.props.formCreateInject=this.injectProp(e);var a=!1!==o.cache,u=o.preview;if(o.hidden)return void this.setCache(e,void 0,t);i=function(){for(var i=arguments.length,c=new Array(i),s=0;s<i;s++)c[s]=arguments[s];var l={rule:r,prop:o,preview:u,api:n.$handle.api,model:o.model||{},slotValue:c};c.length&&r.slotUpdate&&xe((function(){return r.slotUpdate(l)}));var f={},d=e.loadChildrenPending();e.parser.renderChildren?f=e.parser.renderChildren(d,e):!1!==e.parser.loadChildren&&(f=n.renderChildren(d,e));var p,h=n.getTypeSlot(e);return h?(l.children=f,p=h(l)):p=u?e.parser.preview(T(f),e):e.parser.render(T(f),e),p=n.renderSides(p,e),!e.input&&m.Undef(o.native)||!0===o.native||(n.fc.targetFormDriver("updateWrap",e),p=n.$manager.makeWrap(e,p)),e.none&&(p=Array.isArray(p)?p.map((function(e){return e&&e.__v_isVNode?n.none(e):e})):n.none(p)),a&&n.setCache(e,(function(){return n.stable(p)}),t),p},this.setCache(e,i,t)}return function(){var t=n.getCache(e);if(t)return t.apply(void 0,arguments);if(!n.cache[e.id]){var r=n.renderCtx(e,e.parent);return r?r():void 0}}}catch(e){return void console.error(e)}},none:function(e){if(e)return Array.isArray(e.props.class)?e.props.class.push("fc-none"):e.props.class=e.props.class?[e.props.class,"fc-none"]:"fc-none",e},stable:function(e){var t=this;return(Array.isArray(e)?e:[e]).forEach((function(e){e&&e.__v_isVNode&&e.children&&"object"===a(e.children)&&(e.children.$stable=!0,t.stable(e.children))})),e},getModelField:function(e){return e.prop.modelField||e.parser.modelField||this.fc.modelFields[this.vNode.aliasMap[e.type]]||this.fc.modelFields[e.type]||this.fc.modelFields[e.originType]||"modelValue"},isFragment:function(e){return"fragment"===e.type||"template"===e.type},injectProp:function(e){var t=this,n=this.vm.setupState;n.ctxInject[e.id]||(n.ctxInject[e.id]={api:this.$handle.api,form:this.fc.create,subForm:function(n){t.$handle.addSubForm(e,n)},getSubForm:function(){return t.$handle.subForm[e.id]},slots:function(){return t.vm.setupState.top.slots},options:[],children:[],preview:!1,id:e.id,field:e.field,rule:e.rule,input:e.input,updateValue:function(n){t.$handle.onUpdateValue(e,n)}});var r=n.ctxInject[e.id];return N(r,{preview:e.prop.preview,options:e.prop.options,children:e.loadChildrenPending()}),r},ctxProp:function(e){var t=this,n=e.ref,r=e.key,i=e.rule;this.$manager.mergeProp(e),e.parser.mergeProp(e);var a=[{ref:n,key:i.key||"".concat(r,"fc"),slot:void 0,on:{vnodeMounted:function(n){n.el.__rule__=e.rule,t.onMounted(e,n.el)},"fc.updateValue":function(n){t.$handle.onUpdateValue(e,n)},"fc.el":function(t){e.exportEl=t,t&&((t.$el||t).__rule__=e.rule)}}}];if(e.input){!0===this.vm.props.disabled&&(e.prop.props.disabled=!0);var u=this.getModelField(e),s={callback:function(n){t.onInput(e,n)},value:this.$handle.getFormData(e)};a.push({on:o(c({},"update:".concat(u),s.callback),e.prop.modelEmit?c({},e.prop.modelEmit,(function(){return t.onEmitInput(e)})):{}),props:c({},u,s.value)}),e.prop.model=s}return K(a,e.prop),e.prop},onMounted:function(e,t){e.el=this.vm.refs[e.ref]||t,e.parser.mounted(e),this.$handle.effect(e,"mounted")},onInput:function(e,t){e.prop.modelEmit?this.$handle.onBaseInput(e,t):this.$handle.onInput(e,t)},onEmitInput:function(e){this.$handle.setValue(e,e.parser.toValue(e.modelValue,e),e.modelValue)},renderChildren:function(e,n){var r=this;if(!m.trueArray(e))return{};var i=Ce();return e.map((function(o){if(o)return m.String(o)?i.setSlot(null,o):o.__fc__?r.renderSlot(i,o.__fc__,n):void(o.type&&t.nextTick((function(){r.$handle.loadChildren(e,n),r.$handle.refresh()})))})),i.getSlots()},defaultRender:function(e,t){var n=e.prop;return n.component?"string"==typeof n.component?this.vNode.make(n.component,n,t):this.vNode.makeComponent(n.component,n,t):this.vNode[e.type]?this.vNode[e.type](n,t):this.vNode[e.originType]?this.vNode[e.originType](n,t):this.vNode.make(oe(n.type),n,t)},renderRule:function(e,t,n){var r=this;if(e){if(m.String(e))return e;var i;if(n)i=e.type;else if(i=e.is,e.type){i=ie(e.type);var a=this.vNode.aliasMap[i];a&&(i=ie(a))}if(i){var u=Ce();m.trueArray(e.children)&&e.children.forEach((function(e){e&&u.setSlot(null==e?void 0:e.slot,(function(){return r.renderRule(e)}))}));var c=o({},e);return delete c.type,delete c.is,this.vNode.make(i,c,u.mergeBag(t).getSlots())}}}})}(qe);var We=["hook:updated","hook:mounted"];function He(e,n,r){var i,a=Le(),u=!!n.field;N(this,{id:a,ref:a,wrapRef:a+"fi",rule:n,origin:n.__origin__||n,name:n.name,pending:{},none:!1,watch:[],linkOn:[],root:[],ctrlRule:[],children:[],parent:null,group:n.subRule?this:null,cacheConfig:null,prop:o({},n),computed:{},payload:{},refRule:{},input:u,el:void 0,exportEl:void 0,defaultValue:u?A(r):void 0,field:n.field||void 0}),this.updateKey(),i=this,Object.defineProperties(i.origin,{__fc__:ve(t.markRaw(i),!0)}),this.update(e,!0)}function Ge(e,t){for(var n=0;n<e.ctrlRule.length;n++){var r=e.ctrlRule[n];if(r.children===t)return r}}function Ye(e){return!!e.rule.__ctrl}function ze(e,t){return"function"==typeof t?""+t:t}N(He.prototype,{getParentGroup:function(){for(var e=this.parent;e;){if(e.group)return e;e=e.parent}},loadChildrenPending:function(){var e=this,t=this.rule.children||[];return Array.isArray(t)?t:this.loadPending({key:"children",origin:t,def:[],onLoad:function(t){e.$handle&&e.$handle.loadChildren(t,e)},onUpdate:function(t,n){e.$handle&&(t===n?e.$handle.loadChildren(t,e):e.$handle.updateChildren(e,t,n))},onReload:function(t){e.$handle?e.$handle.updateChildren(e,[],t):delete e.pending.children}})},loadPending:function(e){var t=this,n=e.key,r=e.origin,i=e.def,o=e.onLoad,a=e.onReload,u=e.onUpdate;if(this.pending[n]&&this.pending[n].origin===r)return this.getPending(n,i);delete this.pending[n];var c=r;if(m.Function(r)){var s=xe((function(){return r({rule:t.rule,api:t.$api,update:function(e){var o=e||i,a=t.getPending(n,i);t.setPending(n,r,o),u&&u(o,a)},reload:function(){var e=t.getPending(n,i);delete t.pending[n],a&&a(e),t.$api&&t.$api.sync(t.rule)}})}));s&&m.Function(s.then)?(s.then((function(e){var a=e||i;t.setPending(n,r,a),o&&o(a),t.$api&&t.$api.sync(t.rule)})).catch((function(e){console.error(e)})),c=i,this.setPending(n,r,c)):(c=s||i,this.setPending(n,r,c),o&&o(c))}return c},getPending:function(e,t){return this.pending[e]&&this.pending[e].value||t},setPending:function(e,n,r){this.pending[e]={origin:n,value:t.reactive(r)}},effectData:function(e){return this.payload[e]||(this.payload[e]={}),this.payload[e]},clearEffectData:function(e){void 0===e?this.payload={}:delete this.payload[e]},updateKey:function(e){this.key=Le(),e&&this.parent&&this.parent.updateKey(e)},updateType:function(){this.originType=this.rule.type,this.type=ie(this.rule.type),this.trueType=this.$handle.getType(this.originType)},setParser:function(e){this.parser=e,e.init(this)},initProp:function(){var e=this,t=o({},this.rule);delete t.children,this.prop=be({},[t].concat(p(Object.keys(this.payload).map((function(t){return e.payload[t]}))),[this.computed]))},initNone:function(){this.none=!(m.Undef(this.prop.display)||this.prop.display)},injectValidate:function(){var e=this;return x(this.prop.validate).map((function(t){if(m.Function(t.validator)){var n=o({},t),r=e;return n.validator=function(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.validator).call.apply(e,[{that:this,id:r.id,field:r.field,rule:r.rule,api:r.$handle.api}].concat(i))},n}return t}))},check:function(e){return this.vm===e.vm},unwatch:function(){this.watch.forEach((function(e){return e()})),this.watch=[],this.refRule={}},unlink:function(){this.linkOn.forEach((function(e){return e()})),this.linkOn=[]},link:function(){this.unlink(),this.$handle.appendLink(this)},watchTo:function(){this.$handle.watchCtx(this)},delete:function(){this.unwatch(),this.unlink(),this.rmCtrl(),this.parent&&this.parent.children.splice(this.parent.children.indexOf(this)>>>0,1),N(this,{deleted:!0,computed:{},parent:null,children:[],cacheConfig:null,none:!1})},rmCtrl:function(){this.ctrlRule.forEach((function(e){return e.__fc__&&e.__fc__.rm()})),this.ctrlRule=[]},rm:function(){var e=this,t=function(){var t=e.root.indexOf(e.origin);t>-1&&(e.root.splice(t,1),e.$handle&&e.$handle.refresh())};this.deleted?t():this.$handle.noWatch((function(){e.$handle.deferSyncValue((function(){e.rmCtrl(),t(),e.$handle.rmCtx(e),N(e,{root:[]})}),e.input)}))},update:function(e,t){N(this,{deleted:!1,$handle:e,$render:e.$render,$api:e.api,vm:e.vm,vNode:e.$render.vNode,updated:!1,cacheValue:this.rule.value}),!t&&this.unwatch(),this.watchTo(),this.link(),this.updateType()}});var Ke={init:function(e){},toFormValue:function(e,t){return e},toValue:function(e,t){return e},mounted:function(e){},render:function(e,t){return t.$handle.fc.renderDriver&&t.$handle.fc.renderDriver.defaultRender?t.$handle.fc.renderDriver.defaultRender(t,e):t.$render.defaultRender(t,e)},preview:function(e,t){return t.$handle.fc.renderDriver&&t.$handle.fc.renderDriver.defaultPreview?t.$handle.fc.renderDriver.defaultPreview(t,e):this.render(e,t)},mergeProp:function(e){}},Xe=["field","value","vm","template","name","config","control","inject","sync","payload","optionsTo","update","slotUpdate","computed","component","cache"];function Ze(e){var n=this;_e(this,{options:function(){return e.options.value||{}},bus:function(){return e.bus},preview:function(){return null!=e.vm.props.preview?e.vm.props.preview:e.options.value.preview||!1}}),N(this,{fc:e,vm:e.vm,watching:!1,loading:!1,reloading:!1,noWatchFn:null,deferSyncFn:null,isMounted:!1,formData:t.reactive({}),subRuleData:t.reactive({}),subForm:{},form:t.reactive({}),appendData:{},ignoreFields:[],providers:{},cycleLoad:null,loadedId:1,nextTick:null,changeStatus:!1,pageEnd:!0,nextReload:function(){n.lifecycle("reload")}}),this.initData(e.rules),this.$manager=new e.manager(this),this.$render=new qe(this),this.api=e.extendApiFn.reduce((function(e,t){return N(e,xe((function(){return t(e,n)}),{})),e}),function(e){function n(t){return m.Undef(t)?t=e.fields():Array.isArray(t)||(t=[t]),t}function r(t,r,i){n(t).forEach((function(t){e.getCtxs(t).forEach((function(t){F(t.rule,r,i),e.$render.clearCache(t)}))}))}function i(){var t=e.subForm;return Object.keys(t).reduce((function(e,n){var r=t[n];return r?(Array.isArray(r)?e.push.apply(e,p(r)):e.push(r),e):e}),[])}var u={get config(){return e.options},set config(t){e.fc.options.value=t},get options(){return e.options},set options(t){e.fc.options.value=t},get form(){return e.form},get rule(){return e.rules},get parent(){return e.vm.setupState.parent&&e.vm.setupState.parent.setupState.fapi},get top(){return u.parent?u.parent.top:u},get children(){return i()},get siblings(){var t=e.vm.setupState.getGroupInject();if(t){var n=t.getSubForm();if(Array.isArray(n))return p(n)}},get index(){var e=u.siblings;if(e){var t=e.indexOf(u);return t>-1?t:void 0}},formData:function(t){if(null==t){var r={};return Object.keys(e.form).forEach((function(t){-1===e.ignoreFields.indexOf(t)&&(r[t]=Be(e.form[t]))})),r}return n(t).reduce((function(e,t){return e[t]=u.getValue(t),e}),{})},getValue:function(t){var n=e.getFieldCtx(t);return n?Be(n.rule.value):!1!==e.options.appendValue&&v(e.appendData,t)?Be(e.appendData[t]):void 0},coverValue:function(t){var n=o({},t||{});e.deferSyncValue((function(){e.appendData={},u.fields().forEach((function(r){var i=e.fieldCtx[r];if(i){var o=v(t,r);i.forEach((function(e){e.rule.value=o?t[r]:void 0})),delete n[r]}})),N(e.appendData,n)}),!0)},setValue:function(t){var n=t;arguments.length>=2&&(n=c({},t,arguments[1])),e.deferSyncValue((function(){Object.keys(n).forEach((function(t){var r=e.fieldCtx[t];if(!r)return e.appendData[t]=n[t];r.forEach((function(e){e.rule.value=n[t]}))}))}),!0)},removeField:function(t){var n=e.getCtx(t);return e.deferSyncValue((function(){e.getCtxs(t).forEach((function(e){e.rm()}))}),!0),n?n.origin:void 0},removeRule:function(e){var t=e&&we(e);if(t)return t.rm(),t.origin},fields:function(){return e.fields()},append:function(t,n,r){var i,o=e.sort.length-1,a=e.getCtx(n);if(a)if(r){if(i=a.getPending("children",a.rule.children),!Array.isArray(i))return;o=a.rule.children.length-1}else o=a.root.indexOf(a.origin),i=a.root;else i=e.rules;i.splice(o+1,0,t)},prepend:function(t,n,r){var i,o=0,a=e.getCtx(n);if(a)if(r){if(i=a.getPending("children",a.rule.children),!Array.isArray(i))return}else o=a.root.indexOf(a.origin),i=a.root;else i=e.rules;i.splice(o,0,t)},hidden:function(t,n){r(n,"hidden",!!t),e.refresh()},hiddenStatus:function(t){var n=e.getCtx(t);if(n)return!!n.rule.hidden},display:function(t,n){r(n,"display",!!t),e.refresh()},displayStatus:function(t){var n=e.getCtx(t);if(n)return!!n.rule.display},disabled:function(t,r){n(r).forEach((function(n){e.getCtxs(n).forEach((function(e){F(e.rule.props,"disabled",!!t)}))})),e.refresh()},all:function(t){return Object.keys(e.ctxs).map((function(n){var r=e.ctxs[n];return t?r.origin:r.rule}))},model:function(t){return e.fields().reduce((function(n,r){var i=e.fieldCtx[r][0];return n[r]=t?i.origin:i.rule,n}),{})},component:function(t){return Object.keys(e.nameCtx).reduce((function(n,r){var i=e.nameCtx[r].map((function(e){return t?e.origin:e.rule}));return n[r]=1===i.length?i[0]:i,n}),{})},bind:function(){return u.form},reload:function(t){e.reloadRule(t)},updateOptions:function(t){e.fc.updateOptions(t),u.refresh()},onSubmit:function(e){u.updateOptions({onSubmit:e})},sync:function(t){if(Array.isArray(t))t.forEach((function(e){return u.sync(e)}));else{var n=m.Object(t)?we(t):e.getCtxs(t);n&&((n=Array.isArray(n)?n:[n]).forEach((function(t){if(!t.deleted){var n=e.subForm[t.id];n&&(Array.isArray(n)?n.forEach((function(e){e.refresh()})):n&&n.refresh()),e.$render.clearCache(t)}})),e.refresh())}},refresh:function(){i().forEach((function(e){e.refresh()})),e.$render.clearCacheAll(),e.refresh()},refreshOptions:function(){e.$manager.updateOptions(e.options),u.refresh()},hideForm:function(t){e.vm.setupState.isShow=!t},changeStatus:function(){return e.changeStatus},clearChangeStatus:function(){e.changeStatus=!1},updateRule:function(t,n){e.getCtxs(t).forEach((function(e){N(e.rule,n)}))},updateRules:function(e){Object.keys(e).forEach((function(t){u.updateRule(t,e[t])}))},mergeRule:function(t,n){e.getCtxs(t).forEach((function(e){be(e.rule,n)}))},mergeRules:function(e){Object.keys(e).forEach((function(t){u.mergeRule(t,e[t])}))},getRule:function(t,n){var r=e.getCtx(t);if(r)return n?r.origin:r.rule},getRenderRule:function(t){var n=e.getCtx(t);if(n)return n.prop},getRefRule:function(t){var n=e.getCtxs(t);if(n){var r=n.map((function(e){return e.rule}));return 1===r.length?r[0]:r}},setEffect:function(t,n,r){var i=e.getCtx(t);i&&n&&("$"===n[0]&&(n=n.substr(1)),v(i.rule,"$"+n)&&F(i.rule,"$"+n,r),v(i.rule,"effect")||(i.rule.effect={}),F(i.rule.effect,n,r))},clearEffectData:function(t,n){var r=e.getCtx(t);r&&(n&&"$"===n[0]&&(n=n.substr(1)),r.clearEffectData(n),u.sync(t))},updateValidate:function(e,t,n){n?u.mergeRule(e,{validate:t}):r(e,"validate",t)},updateValidates:function(e,t){Object.keys(e).forEach((function(n){u.updateValidate(n,e[n],t)}))},refreshValidate:function(){u.refresh()},resetFields:function(r){n(r).forEach((function(t){e.getCtxs(t).forEach((function(t){e.$render.clearCache(t),t.rule.value=Be(t.defaultValue)}))})),t.nextTick((function(){u.clearValidateState()})),null==r&&(m.Function(e.options.onReset)&&xe((function(){return e.options.onReset(u)})),e.vm.emit("reset",u))},method:function(e,t){var n=u.el(e);if(!n||!n[t])throw new Error(ne("err","".concat(t," 方法不存在")));return function(){return n[t].apply(n,arguments)}},exec:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return xe((function(){return u.method(e,t).apply(void 0,r)}))},toJson:function(e){return de(u.rule,e)},trigger:function(e,t){for(var n=u.el(e),r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];n&&n.$emit.apply(n,[t].concat(i))},el:function(t){var n=e.getCtx(t);if(n)return n.el||e.vm.refs[n.ref]},closeModal:function(t){e.bus.$emit("fc:closeModal:"+t)},getSubForm:function(t){var n=e.getCtx(t);return n?e.subForm[n.id]:void 0},getChildrenRuleList:function(t){var n="object"===a(t),r=n?we(t):e.getCtx(t),i=r?r.rule:n?t:u.getRule(t);if(!i)return[];var o,c=[];return(o=r?r.loadChildrenPending():i.children)&&o.forEach((function(e){"object"===a(e)&&(e.field&&c.push(e),c.push.apply(c,p(u.getChildrenRuleList(e))))})),c},getParentRule:function(t){return("object"===a(t)?we(t):e.getCtx(t)).parent.rule},getParentSubRule:function(t){var n="object"===a(t)?we(t):e.getCtx(t);if(n){var r=n.getParentGroup();if(r)return r.rule}},getChildrenFormData:function(e){return u.getChildrenRuleList(e).reduce((function(e,t){return e[t.field]=Be(t.value),e}),{})},setChildrenFormData:function(t,n,r){var i=u.getChildrenRuleList(t);e.deferSyncValue((function(){i.forEach((function(e){v(n,e.field)?e.value=n[e.field]:r&&(e.value=void 0)}))}))},getGlobalEvent:function(e){var t=u.options.globalEvent[e];if(t)return"object"===a(t)&&(t=t.handle),he(t)},getGlobalData:function(t){return new Promise((function(n,r){var i=u.options.globalData[t];i||n(e.fc.loadData[t]),"fetch"===i.type?u.fetch(i).then((function(e){n(e)})).catch(r):n(i.data)}))},nextTick:function(t){e.bus.$once("next-tick",t),e.refresh()},nextRefresh:function(t){e.nextRefresh(),t&&xe(t)},deferSyncValue:function(t,n){e.deferSyncValue(t,n)},emit:function(t){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];(n=e.vm).emit.apply(n,[t].concat(i))},bus:e.bus,fetch:function(t){return new Promise((function(n,r){t=A(t),t=e.loadFetchVar(t),e.beforeFetch(t).then((function(){return Me(t,e.fc.create.fetch).then((function(e){xe((function(){return t.onSuccess&&t.onSuccess(e)})),n(e)})).catch((function(e){xe((function(){return t.onError&&t.onError(e)})),r(e)}))}))}))},watchFetch:function(t,n,r){return e.fc.watchLoadData((function(i,o){var a=A(t);a=e.loadFetchVar(a,i),e.beforeFetch(a).then((function(){return Me(a,e.fc.create.fetch).then((function(e){xe((function(){return a.onSuccess&&a.onSuccess(e)})),n&&n(e,o)})).catch((function(e){xe((function(){return a.onError&&a.onError(e)})),r&&r(e)}))}))}))},getData:function(t,n){return e.fc.getLoadData(t,n)},setData:function(t,n,r){return e.fc.setData(t,n,r)},refreshData:function(t){return e.fc.refreshData(t)},helper:{tidyFields:n,props:r}};return["on","once","off"].forEach((function(t){u[t]=function(){var n;(n=e.bus)["$".concat(t)].apply(n,arguments)}})),u.changeValue=u.changeField=u.setValue,u}(this))}N(Ze.prototype,{initData:function(e){N(this,{ctxs:{},fieldCtx:{},nameCtx:{},sort:[],rules:e})},init:function(){this.updateAppendData(),this.useProvider(),this.usePage(),this.loadRule(),this.$manager.__init(),this.lifecycle("created")},updateAppendData:function(){this.appendData=o(o(o({},this.options.formData||{}),this.fc.vm.props.modelValue||{}),this.appendData)},isBreakWatch:function(){return this.loading||this.noWatchFn||this.reloading},beforeFetch:function(e){var t=this;return new Promise((function(n){var r=t.options.beforeFetch&&xe((function(){return t.options.beforeFetch(e,{api:t.api})}));r&&m.Function(r.then)?r.then(n):n()}))}}),function(e){N(e.prototype,{parseInjectEvent:function(e,t){var n=e.inject||this.options.injectEvent;return this.parseEventLst(e,t,n)},parseEventLst:function(e,t,n,r){var i=this;return Object.keys(t).forEach((function(o){var a=i.parseEvent(e,t[o],n,r);a&&(t[o]=a)})),t},parseEvent:function(e,t,n,r){if(m.Function(t)&&(!1!==n&&!m.Undef(n)||t.__inject))return this.inject(e,t,n);if(!r&&Array.isArray(t)&&t[0]&&(m.String(t[0])||m.Function(t[0])))return this.parseEventLst(e,t,n,!0);if(m.String(t)){var i=he(t);if(i&&t!==i)return i.__inject?this.parseEvent(e,i,n,!0):i}},parseEmit:function(e){var t=this,n={},r=e.rule,i=r.emitPrefix,o=r.field,a=r.name,u=r.inject,c=r.emit||[];return m.trueArray(c)&&c.forEach((function(e){if(e){var c,s=i||o||a;if(m.Object(e)&&(c=e.inject,s=(e=e.name).prefix||s),s){var l=q("".concat(s,"-").concat(e)),f=function(){var e,n,r;t.vm.emitsOptions&&(t.vm.emitsOptions[l]=null);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];(e=t.vm).emit.apply(e,[l].concat(o)),(n=t.vm).emit.apply(n,["emit-event",l].concat(o)),(r=t.bus).$emit.apply(r,[l].concat(o))};if(f.__emit=!0,c||!1!==u){var d=c||u||t.options.injectEvent;n[e]=m.Undef(d)?f:t.inject(r,f,d)}else n[e]=f}}})),e.computed.on=n,n},getInjectData:function(e,t){var n=e.__fc__&&e.__fc__.$api,r=(e.__fc__&&e.__fc__.$handle.vm||this.vm.props).props,i=r.option,o=r.rule;return{$f:n||this.api,api:n||this.api,rule:o,self:e.__origin__,option:i,inject:t}},inject:function(e,t,n){if(t.__origin){if(this.watching&&!this.loading)return t;t=t.__origin}var r=this,i=function(){for(var i=r.getInjectData(e,n),o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return i.args=[].concat(a),a.unshift(i),t.apply(this,a)};return i.__origin=t,i.__json=t.__json,i},loadStrVar:function(e,t){var n=this;if(e&&"string"==typeof e&&e.indexOf("{{")>-1&&e.indexOf("}}")>-1){var r,i=e,o=function(e){for(var t,n=/{{\s*(.*?)\s*}}/g,r={};null!==(t=n.exec(e));)t[1]&&(r[t[1]]=!0);return Object.keys(r)}(e);if(o.forEach((function(i){var o=i.split("||"),a=o[0].trim();if(a){var u=(o[1]||"").trim(),c=t?t(a,u):n.fc.getLoadData(a,u);r=c,e=e.replaceAll("{{".concat(i,"}}"),null==c?"":c)}})),1===o.length&&i==="{{".concat(o[0],"}}"))return r}return e},loadFetchVar:function(e,t){var n=this,r=function(e){return n.loadStrVar(e,t)};if(e.action=r(e.action),e.headers){var i={};Object.keys(e.headers).forEach((function(t){i[r(t)]=r(e.headers[t])})),e.headers=i}if(e.data){var o={};Object.keys(e.data).forEach((function(t){o[r(t)]=r(e.data[t])})),e.data=o}return e}})}(Ze),function(e){N(e.prototype,{usePage:function(){var e=this,t=this.options.page;if(t){var n,r=25,i=(n=this.rules).length<31?31:Math.ceil(n.length/3);m.Object(t)&&(t.first&&(r=parseInt(t.first,10)||r),t.limit&&(i=parseInt(t.limit,10)||i)),N(this,{first:r,limit:i,pageEnd:this.rules.length<=r}),this.bus.$on("page-end",(function(){return e.vm.emit("page-end",e.api)})),this.pageLoad()}},pageLoad:function(){var e=this;this.bus.$on(We,(function t(){e.pageEnd?(e.bus.$off(We,t),e.bus.$emit("page-end")):(e.first+=e.limit,e.pageEnd=e.rules.length<=e.first,e.loadRule(),e.refresh())}))}})}(Ze),function(e){N(e.prototype,{clearNextTick:function(){this.nextTick&&clearTimeout(this.nextTick),this.nextTick=null},bindNextTick:function(e){var t=this;this.clearNextTick(),this.nextTick=setTimeout((function(){e(),t.nextTick=null}),10)},render:function(){return++this.loadedId,this.vm.setupState.unique>0?this.$render.render():(this.vm.setupState.unique=1,[])}})}(Ze),function(e){N(e.prototype,{nextRefresh:function(e){var n=this,r=this.loadedId;t.nextTick((function(){r===n.loadedId&&(e?e():n.refresh())}))},parseRule:function(e){var t=this,n=$e(e);return Object.defineProperties(n,{__origin__:ve(e,!0)}),function(e){var t={props:{},on:{},options:[],children:[],hidden:!1,display:!0,value:void 0};Object.keys(t).forEach((function(n){v(e,n)||(e[n]=t[n])}))}(n),this.appendValue(n),[n,n.prefix,n.suffix].forEach((function(e){e&&t.loadFn(e,n)})),this.loadCtrl(n),n.update&&(n.update=he(n.update)),n},loadFn:function(e,t){var n=this;["on","props","deep"].forEach((function(r){e[r]&&n.parseInjectEvent(t,e[r])}))},loadCtrl:function(e){e.control&&e.control.forEach((function(e){e.handle&&(e.handle=he(e.handle))}))},syncProp:function(e){var t=this,n=e.rule;m.trueArray(n.sync)&&K([{on:n.sync.reduce((function(e,r){return e["update:".concat(r)]=function(e){n.props[r]=e,t.vm.emit("sync",r,e,n,t.fapi)},e}),{})}],e.computed)},loadRule:function(){var e=this;this.cycleLoad=!1,this.loading=!0,this.pageEnd&&this.bus.$emit("load-start"),this.deferSyncValue((function(){if(e._loadRule(e.rules),e.loading=!1,e.cycleLoad&&e.pageEnd)return e.loadRule();e.syncForm(),e.pageEnd&&e.bus.$emit("load-end"),e.vm.setupState.renderRule()}))},loadChildren:function(e,t){if(this.cycleLoad=!1,this.loading=!0,this.bus.$emit("load-start"),this._loadRule(e,t),this.loading=!1,this.cycleLoad)return this.loadRule();this.syncForm(),this.bus.$emit("load-end"),this.$render.clearCache(t)},_loadRule:function(e,t){var n=this,r=function t(r){var i=e[r-1];if(!i||!i.__fc__)return r>0?t(r-1):-1;var o=n.sort.indexOf(i.__fc__.id);return o>-1?o:t(r-1)},i=function(e,t){m.trueArray(e)&&n._loadRule(e,t)},o=e.map((function(o,a){if((!t||m.Object(o))&&(n.pageEnd||t||!(a>=n.first))){if(o.__fc__&&o.__fc__.root===e&&n.ctxs[o.__fc__.id])return i(o.__fc__.loadChildrenPending(),o.__fc__),o.__fc__;var u,c=$e(o),s=function(){return!(!c.field||!n.fieldCtx[c.field]||n.fieldCtx[c.field][0]===o.__fc__)};n.fc.targetFormDriver("loadRule",{rule:c,api:n.api},n.fc),n.ruleEffect(c,"init",{repeat:s()}),s()&&n.vm.emit("repeat-field",o,n.api);var l=!1,f=!!o.__fc__,d=c.value;if(f)if(d=(u=o.__fc__).defaultValue,u.deleted){if(Ye(u))return;u.update(n)}else if(!u.check(n)){if(Ye(u))return;e[a]=o=o._clone?o._clone():ge(o),u=null,l=!0}if(u)u.originType!==u.rule.type&&u.updateType(),n.bindParser(u),n.appendValue(u.rule),u.parent&&u.parent!==t&&n.rmSubRuleData(u);else{var p=n.parseRule(o);u=new He(n,p,d),n.bindParser(u)}n.parseEmit(u),n.syncProp(u),u.parent=t||null,u.root=e,n.setCtx(u),!l&&!f&&n.effect(u,"load"),n.effect(u,"created");var h=u.loadChildrenPending();if(!1===u.parser.loadChildren||i(h,u),!t){var v=r(a);v>-1||!a?n.sort.splice(v+1,0,u.id):n.sort.push(u.id)}var g=u.rule;return u.updated||(u.updated=!0,m.Function(g.update)&&n.bus.$once("load-end",(function(){n.refreshUpdate(u,g.value,"init")})),n.effect(u,"loaded")),n.refreshControl(u)&&(n.cycleLoad=!0),u}})).filter((function(e){return!!e}));t&&(t.children=o)},refreshControl:function(e){return e.input&&e.rule.control&&this.useCtrl(e)},useCtrl:function(e){var n=this,r=function(e){var t=e.rule.control||[];return m.Object(t)?[t]:t}(e),i=[],a=this.api;if(!r.length)return!1;for(var u=function(t){var n=r[t],u=n.handle||function(e){return(ke[n.condition||"=="]||ke["=="])(e,n.value)};if(!m.trueArray(n.rule))return"continue";var c=o(o({},n),{},{valid:xe((function(){return u(e.rule.value,a)})),ctrl:Ge(e,n.rule),isHidden:m.String(n.rule[0])});if(c.valid&&c.ctrl||!c.valid&&!c.ctrl&&!c.isHidden)return"continue";i.push(c)},c=0;c<r.length;c++)u(c);if(!i.length)return!1;var s=[],l=!1;return this.deferSyncValue((function(){i.reverse().forEach((function(t){var r=t.isHidden,i=t.valid,o=t.rule,u=t.prepend,c=t.append,f=t.child,d=t.ctrl,p=t.method;if(r)return i?e.ctrlRule.push({__ctrl:!0,children:o,valid:i}):d&&e.ctrlRule.splice(e.ctrlRule.indexOf(d)>>>0,1),void s[i?"push":"unshift"]((function(){"disabled"===p||"enabled"===p?n.api.disabled(!i,o):"display"===p?n.api.display(i,o):"required"===p?(o.forEach((function(e){n.api.setEffect(e,"required",i)})),i||n.api.clearValidateState(o)):n.api.hidden(!i,o)}));if(i){l=!0;var h={type:"fragment",native:!0,__ctrl:!0,children:o};e.ctrlRule.push(h),n.bus.$once("load-start",(function(){u?a.prepend(h,u,f):c||f?a.append(h,c||e.id,f):e.root.splice(e.root.indexOf(e.origin)+1,0,h)}))}else{e.ctrlRule.splice(e.ctrlRule.indexOf(d),1);var m=we(d);m&&m.rm()}}))})),s.length&&(this.loading?s.length&&this.bus.$once("load-end",(function(){s.forEach((function(e){return e()}))})):s.length&&t.nextTick((function(){s.forEach((function(e){return e()}))}))),this.vm.emit("control",e.origin,this.api),this.effect(e,"control"),l},reloadRule:function(e){return this._reloadRule(e)},_reloadRule:function(e){var t=this;e||(e=this.rules);var n=o({},this.ctxs);this.clearNextTick(),this.initData(e),this.fc.rules=e,this.deferSyncValue((function(){t.bus.$once("load-end",(function(){Object.keys(n).filter((function(e){return void 0===t.ctxs[e]})).forEach((function(e){return t.rmCtx(n[e])})),t.$render.clearCacheAll()})),t.reloading=!0,t.loadRule(),t.reloading=!1,t.refresh(),t.bus.$emit("reloading",t.api)})),this.bus.$off("next-tick",this.nextReload),this.bus.$once("next-tick",this.nextReload),this.bus.$emit("update",this.api)},refresh:function(){this.vm.setupState.refresh()}})}(Ze),function(e){N(e.prototype,{setValue:function(e,t,n,r){e.deleted||(e.rule.value=t,this.changeStatus=!0,this.nextRefresh(),this.$render.clearCache(e),this.setFormData(e,n),this.syncValue(),this.valueChange(e,t),this.vm.emit("change",e.field,t,e.origin,this.api,r||!1),this.effect(e,"value"),this.emitEvent("change",e.field,t,{rule:e.origin,api:this.api,setFlag:r||!1}))},onInput:function(e,t){var n;e.input&&(this.isQuote(e,n=e.parser.toValue(t,e))||this.isChange(e,t))&&this.setValue(e,n,t)},onUpdateValue:function(e,t){var n=this;this.deferSyncValue((function(){var r=e.getParentGroup(),i=r?n.subRuleData[r.id]:null,o={};Object.keys(t||{}).forEach((function(e){i&&v(i,e)?o[e]=t[e]:v(n.api.form,e)?n.api.form[e]=t[e]:n.api.top!==n.api&&v(n.api.top.form,e)&&(n.api.top.form[e]=t[e])})),Object.keys(o).length&&n.api.setChildrenFormData(r.rule,o)}))},onBaseInput:function(e,t){this.setFormData(e,t),e.modelValue=t,this.nextRefresh(),this.$render.clearCache(e)},setFormData:function(e,t){e.modelValue=t;var n=e.getParentGroup();n&&(this.subRuleData[n.id]||(this.subRuleData[n.id]={}),this.subRuleData[n.id][e.field]=e.rule.value),F(this.formData,e.id,t)},rmSubRuleData:function(e){var t=e.getParentGroup();t&&this.subRuleData[t.id]&&delete this.subRuleData[t.id][e.field]},getFormData:function(e){return this.formData[e.id]},syncForm:function(){var e=this,n=t.reactive({}),r=this.fields(),i=[];!1!==this.options.appendValue&&Object.keys(this.appendData).reduce((function(n,i){return-1===r.indexOf(i)&&(n[i]=t.toRef(e.appendData,i)),n}),n),r.reduce((function(n,r){var o=(e.fieldCtx[r]||[]).filter((function(t){return!e.isIgnore(t.rule)}))[0]||e.fieldCtx[r][0];return e.isIgnore(o.rule)&&i.push(r),n[r]=t.toRef(o.rule,"value"),n}),n),this.form=n,this.ignoreFields=i,this.syncValue()},isIgnore:function(e){return!0===e.ignore||"hidden"===e.ignore&&e.hidden||this.options.ignoreHiddenFields&&e.hidden},appendValue:function(e){(e.field&&v(this.appendData,e.field)||this.options.forceCoverValue)&&(e.value=this.appendData[e.field],delete this.appendData[e.field])},addSubForm:function(e,t){this.subForm[e.id]=t},deferSyncValue:function(e,t){this.deferSyncFn||(this.deferSyncFn=e),this.deferSyncFn.sync||(this.deferSyncFn.sync=t),xe(e),this.deferSyncFn===e&&(this.deferSyncFn=null,e.sync&&this.syncForm())},syncValue:function(){var e=this;if(this.deferSyncFn)return this.deferSyncFn.sync=!0;var t={};Object.keys(this.form).forEach((function(n){-1===e.ignoreFields.indexOf(n)&&(t[n]=e.form[n])})),this.vm.setupState.updateValue(t)},isChange:function(e,t){return JSON.stringify(this.getFormData(e),ze)!==JSON.stringify(t,ze)},isQuote:function(e,t){return(m.Object(t)||Array.isArray(t))&&t===e.rule.value},refreshUpdate:function(e,t,n,r){var i=this;if(m.Function(e.rule.update)){var o=xe((function(){return e.rule.update(t,e.origin,i.api,{origin:n||"change",linkField:r})}));if(void 0===o)return;e.rule.hidden=!0===o}},valueChange:function(e,t){this.refreshRule(e,t),this.bus.$emit("change-"+e.field,t)},refreshRule:function(e,t,n,r){this.refreshControl(e)&&(this.$render.clearCacheAll(),this.loadRule(),this.bus.$emit("update",this.api),this.refresh()),this.refreshUpdate(e,t,n,r)},appendLink:function(e){var t=this,n=e.rule.link;m.trueArray(n)&&n.forEach((function(n){var r=function(){return t.refreshRule(e,e.rule.value,"link",n)};t.bus.$on("change-"+n,r),e.linkOn.push((function(){return t.bus.$off("change-"+n,r)}))}))},fields:function(){return Object.keys(this.fieldCtx)}})}(Ze),function(e){N(e.prototype,{getCtx:function(e){return this.getFieldCtx(e)||this.getNameCtx(e)[0]||this.ctxs[e]},getCtxs:function(e){return this.fieldCtx[e]||this.nameCtx[e]||(this.ctxs[e]?[this.ctxs[e]]:[])},setIdCtx:function(e,t,n){var r="".concat(n,"Ctx");this[r][t]?this[r][t].push(e):this[r][t]=[e]},rmIdCtx:function(e,t,n){var r="".concat(n,"Ctx"),i=this[r][t];if(!i)return!1;var o=i.splice(i.indexOf(e)>>>0,1).length>0;return i.length||delete this[r][t],o},getFieldCtx:function(e){return(this.fieldCtx[e]||[])[0]},getNameCtx:function(e){return this.nameCtx[e]||[]},setCtx:function(e){var t=e.id,n=e.field,r=e.name,i=e.rule;this.ctxs[t]=e,r&&this.setIdCtx(e,r,"name"),e.input&&(this.setIdCtx(e,n,"field"),this.setFormData(e,e.parser.toFormValue(i.value,e)),this.isMounted&&!this.reloading&&this.vm.emit("change",e.field,i.value,e.origin,this.api))},getParser:function(e){var t=this.fc.parsers,n=this.fc.renderDriver;if(n){var r=n.parsers||{},i=r[e.originType]||r[ie(e.type)]||r[e.trueType];if(i)return i}return t[e.originType]||t[ie(e.type)]||t[e.trueType]||Ke},bindParser:function(e){e.setParser(this.getParser(e))},getType:function(e){var t=this.fc.CreateNode.aliasMap,n=t[e]||t[ie(e)]||e;return ie(n)},noWatch:function(e){this.noWatchFn||(this.noWatchFn=e),xe(e),this.noWatchFn===e&&(this.noWatchFn=null)},watchCtx:function(e){var n=this;if(te().filter((function(e){return"_"!==e[0]&&"$"!==e[0]&&-1===Xe.indexOf(e)})).forEach((function(r){var i=t.toRef(e.rule,r),o="children"===r;e.refRule[r]=i,e.watch.push(t.watch(o?function(){return m.Function(i.value)?i.value:p(i.value||[])}:function(){return i.value},(function(t,a){var u=i.value;if(!n.isBreakWatch()){if(o&&!1===e.parser.loadChildren)return n.$render.clearCache(e),void n.nextRefresh();if(n.watching=!0,"hidden"===r&&Boolean(u)!==Boolean(a)&&n.$render.clearCacheAll(),"ignore"===r&&e.input||"hidden"===r&&e.input&&("hidden"===e.rule.ignore||n.options.ignoreHiddenFields))n.syncForm();else{if("link"===r)return void e.link();["props","on","deep"].indexOf(r)>-1?(n.parseInjectEvent(e.rule,u||{}),"props"===r&&e.input&&n.setFormData(e,e.parser.toFormValue(e.rule.value,e))):"emit"===r?n.parseEmit(e):["prefix","suffix"].indexOf(r)>-1?u&&n.loadFn(u,e.rule):"type"===r?(e.updateType(),n.bindParser(e)):o&&(m.Function(a)&&(a=e.getPending("children",[])),m.Function(u)&&(u=e.loadChildrenPending()),n.updateChildren(e,u,a))}n.$render.clearCache(e),n.refresh(),n.watching=!1}}),{deep:!o,sync:o}))})),e.input){var r=t.toRef(e.rule,"value");e.watch.push(t.watch((function(){return r.value}),(function(){var t=e.parser.toFormValue(r.value,e);n.isChange(e,t)&&n.setValue(e,r.value,t,!0)})))}this.bus.$once("load-end",(function(){var r=e.rule.computed;r&&("object"!==a(r)&&(r={value:r}),Object.keys(r).forEach((function(i){var o=void 0,a=t.computed((function(){var t=r[i];if(t){var a=n.compute(e,t);return t.linkage&&void 0===a?o:a}})),u=function(t){"value"===i?n.onInput(e,t):"$"===i[0]?n.api.setEffect(e.id,i,t):Ue(e.rule,i,t)};("value"===i?[void 0,null,""].indexOf(e.rule.value)>-1:a.value!==De(e.rule,i))&&u(a.value),e.watch.push(t.watch(a,(function(e){o=e,setTimeout((function(){u(e)}))})))})))})),this.watchEffect(e)},compute:function(e,t){var n,r=this;if("object"===a(t)){var i=e.getParentGroup(),o=function e(t){if(t=Array.isArray(t)?{mode:"AND",group:t}:t,!m.trueArray(t.group))return!0;for(var n="OR"===t.mode,o=!0,a=0;a<t.group.length;a++){var u=t.group[a],c=void 0;if(c=u.mode?e(u):!!ke[u.condition]&&new Function("$condition","$val","$form","$group","with($form){with(this){with($group){ return $condition['".concat(u.condition,"'](").concat(u.field,", ").concat(u.compare?u.compare:"$val","); }}}")).call(r.api.form,ke,u.value,r.api.top.form,i&&r.subRuleData[i.id]||{}),n&&c)return!0;n||(o=o&&c)}return!n&&o}(t);return o=!0===t.invert?!o:o,t.linkage?o?xe((function(){return r.computeValue(t.linkage,e,i)}),void 0):void 0:o}if(m.Function(t))n=function(){return t(r.api.form,r.api)};else{var u=e.getParentGroup();n=function(){return r.computeValue(t,e,u)}}return xe(n,void 0)},computeValue:function(e,t,n){var r=this,i=Object.keys(this.fc.formulas).reduce((function(e,n){return e[n]=function(){for(var e,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=r.fc.formulas[n]).call.apply(e,[{that:this,rule:t.rule,api:r.api,fc:r.fc}].concat(o))},e}),{});return new Function("$formulas","$form","$group","$rule","$api","with($form){with(this){with($group){with($formulas){ return ".concat(e," }}}}")).call(this.api.form,i,this.api.top.form,n&&this.subRuleData[n.id]||{},t.rule,this.api)},updateChildren:function(e,t,n){var r=this;this.deferSyncValue((function(){n&&n.forEach((function(n){-1===(t||[]).indexOf(n)&&n&&!m.String(n)&&n.__fc__&&n.__fc__.parent===e&&r.rmCtx(n.__fc__)})),m.trueArray(t)&&(r.loadChildren(t,e),r.bus.$emit("update",r.api))}))},rmSub:function(e){var t=this;m.trueArray(e)&&e.forEach((function(e){e&&e.__fc__&&t.rmCtx(e.__fc__)}))},rmCtx:function(e){var t=this;if(!e.deleted){var n=e.id,r=e.field,i=e.input,o=e.name;R(this.ctxs,n),R(this.formData,n),R(this.subForm,n),R(this.vm.setupState.ctxInject,n);var a=e.getParentGroup();a&&this.subRuleData[a.id]&&R(this.subRuleData[a.id],r),e.group&&R(this.subRuleData,n),i&&this.rmIdCtx(e,r,"field"),o&&this.rmIdCtx(e,o,"name"),i&&!v(this.fieldCtx,r)&&R(this.form,r),this.deferSyncValue((function(){if(!t.reloading){if(!1!==e.parser.loadChildren){var n=e.getPending("children",e.rule.children);m.trueArray(n)&&n.forEach((function(e){return e.__fc__&&t.rmCtx(e.__fc__)}))}e.root===t.rules&&t.vm.setupState.renderRule()}}),i);var u=this.sort.indexOf(n);return u>-1&&this.sort.splice(u,1),this.$render.clearCache(e),e.delete(),this.effect(e,"deleted"),i&&!this.fieldCtx[r]&&this.vm.emit("remove-field",r,e.rule,this.api),e.rule.__ctrl||this.vm.emit("remove-rule",e.rule,this.api),e}}})}(Ze),function(e){N(e.prototype,{mounted:function(){var e=this,t=function(){e.isMounted=!0,e.lifecycle("mounted")};this.pageEnd?t():this.bus.$once("page-end",t)},lifecycle:function(e){this.fc.targetFormDriver(e,this.api,this.fc),this.vm.emit(e,this.api),this.emitEvent(e,this.api)},emitEvent:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=this.options[e]||this.options[ie("on-"+e)];if(o){var a=he(o);m.Function(a)&&xe((function(){return a.apply(void 0,r)}))}(t=this.bus).$emit.apply(t,[e].concat(r))}})}(Ze),function(e){N(e.prototype,{useProvider:function(){var e=this,t=this.fc.providers;Object.keys(t).forEach((function(n){var r=t[n];m.Function(r)&&(r=r(e.fc)),r._c=function(e){var t=e.components;if(Array.isArray(t)){var n=function(e){return e.filter((function(e,t,n){return n.indexOf(e,0)===t}))}(t.filter((function(e){return"*"!==e})));return!!n.length&&n}return!!m.String(t)&&[t]}(r),e.onEffect(r),e.providers[n]=r}))},onEffect:function(e){var t=this,n=[];(e._c||["*"]).forEach((function(r){var i="*"===r?"*":t.getType(r);n.indexOf(i)>-1||(n.push(i),t.bus.$on("p:".concat(e.name,":").concat(i,":").concat(e.input?1:0),(function(t,n){e[t]&&e[t].apply(e,p(n))})))})),e._used=n},watchEffect:function(e){var n=this,r={required:function(){var t,n;return(v(e.rule,"$required")?e.rule.$required:null===(t=e.rule)||void 0===t||null===(n=t.effect)||void 0===n?void 0:n.required)||!1}};Object.keys(e.rule.effect||{}).forEach((function(t){r[t]=function(){return e.rule.effect[t]}})),Object.keys(e.rule).forEach((function(t){"$"===t[0]&&(r[t.substr(1)]=function(){return e.rule[t]})})),Object.keys(r).forEach((function(i){e.watch.push(t.watch(r[i],(function(t){n.effect(e,"watch",c({},i,t))}),{deep:!0}))}))},ruleEffect:function(e,t,n){this.emitEffect({rule:e,input:!!e.field,type:this.getType(e.type)},t,n)},effect:function(e,t,n){this.emitEffect({rule:e.rule,input:e.input,type:e.trueType,ctx:e,custom:n},t)},getEffect:function(e,t){return v(e,"$"+t)?e["$"+t]:v(e,"effect")&&v(e.effect,t)?e.effect[t]:void 0},emitEffect:function(e,t,n){var r=this,i=e.ctx,a=e.rule,u=e.input,c=e.type,s=e.custom;if(c&&!(["fcFragment","fragment"].indexOf(c)>-1)){var l=s||Object.keys(a).reduce((function(e,t){return"$"===t[0]&&(e[t.substr(1)]=a[t]),e}),o({},a.effect||{}));Object.keys(l).forEach((function(e){var s=r.providers[e];if(s&&(!s.input||u)){var f;if(s._c){if(!(s._used.indexOf(c)>-1))return;f=c}else f="*";var d=o({value:l[e],getValue:function(){return r.getEffect(a,e)}},n||{});i&&(d.getProp=function(){return i.effectData(e)},d.clearProp=function(){return i.clearEffectData(e)},d.mergeProp=function(e){return be(d.getProp(),[e])},d.id=i.id),r.bus.$emit("p:".concat(e,":").concat(f,":").concat(s.input?1:0),t,[d,a,r.api])}}))}}})}(Ze);var Qe=t.defineComponent({name:"fcFragment",inheritAttrs:!1,props:["vnode"],render:function(){return this.vnode}});function et(e,n){var r=e.directives;return r?(Array.isArray(r)||(r=[r]),t.withDirectives(n,r.reduce((function(e,n){return e.concat(function(e){return Object.keys(e).map((function(n){var r=e[n],i=t.resolveDirective(n);if(i)return[i,r.value,r.arg,r.modifiers]})).filter((function(e){return!!e}))}(n))}),[]))):n}function tt(){var e={};function n(){}return N(n.prototype,{make:function(e,t,n){return et(t,this.h(e,Oe(t),n))},makeComponent:function(e,n,r){try{return et(n,t.createVNode(e,Oe(n),r))}catch(e){return console.error(e),t.createVNode("")}},h:function(e,n,r){var i=t.getCurrentInstance().appContext.config.isNativeTag(e);i&&delete n.formCreateInject;try{return t.createVNode(i?e:t.resolveComponent(e),n,r)}catch(e){return console.error(e),t.createVNode("")}},aliasMap:e}),N(n,{aliasMap:e,alias:function(t,n){e[t]=n},use:function(e){Object.keys(e).forEach((function(t){var r,i=q(t),o=(r=t,null==r?"":"object"===a(r)?JSON.stringify(r,null,2):String(r)).toLocaleLowerCase(),u=e[t];[t,i,o].forEach((function(e){n.alias(t,u),n.prototype[e]=function(e,t){return this.make(u,e,t)}}))}))}}),n}function nt(e){var t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,e);var t=d(n);function n(){return u(this,n),t.apply(this,arguments)}return n}(rt);return Object.assign(t.prototype,e),t}function rt(e){N(this,{$handle:e,vm:e.vm,options:{},ref:"fcForm",mergeOptionsRule:{normal:["form","row","info","submitBtn","resetBtn"]}}),this.updateKey(),this.init()}N(rt.prototype,{__init:function(){var e=this;this.$render=this.$handle.$render,this.$r=function(){var t;return(t=e.$render).renderRule.apply(t,arguments)}},updateKey:function(){this.key=Le()},init:function(){},update:function(){},beforeRender:function(){},form:function(){return this.vm.refs[this.ref]},getSlot:function(e){return function t(n){if(n){var r=n.slots[e];return r||t(n.setupState.parent)}}(this.vm)},mergeOptions:function(e,t){var n=this;return K(e.map((function(e){return n.tidyOptions(e)})),t,this.mergeOptionsRule)},updateOptions:function(e){this.$handle.fc.targetFormDriver("updateOptions",e,{handle:this.$handle,api:this.$handle.api}),this.options=this.mergeOptions([e],this.getDefaultOptions()),this.update()},tidyOptions:function(e){return e},tidyRule:function(e){},mergeProp:function(e){},getDefaultOptions:function(){return{}},render:function(e){}});var it={name:"componentValidate",load:function(e,t,n){var r=e.getValue();if(r&&!1!==r.method){m.Object(r)||(r={method:r});var i=r.method;delete r.method,e.getProp().validate=[o(o({},r),{},{validator:function(){var r=we(t);if(r){for(var o=arguments.length,a=new Array(o),u=0;u<o;u++)a[u]=arguments[u];return n.exec.apply(n,[r.id,m.String(i)?i:"formCreateValidate"].concat(a,[{attr:e,rule:t,api:n}]))}}})]}else e.clearProp(),n.clearValidateState([t.field])},watch:function(){it.load.apply(it,arguments)}},ot={fetch:function(e){function t(t,r,i){var a=t.value;n.deleted(t),m.Function(a)&&(a=a(r,i)),a=function(e){return m.String(e)&&(e={action:e,to:"options"}),e}(a);var u=function(e){void 0===e?t.clearProp():Ue(t.getProp(),a.to||"options",e),i.sync(r)};if(a&&(a.action||a.key)){if((a=A(a)).to||(a.to="options"),a.key){var c=e.$handle.options.globalData[a.key];if(!c)return void u(void 0);if("static"===c.type)return void u(c.data);a=o(o({},a),c)}var s=a.onError,l=function(){if(!t.getValue())return t.clearProp(),i.sync(r),!0};n._fn[t.id]=e.watchLoadData(J((function(c,f){if(f&&!1===a.watch)return n._fn[t.id]();var d=e.$handle.loadFetchVar(A(a),c),p=o(o({headers:{}},d),{},{onSuccess:function(e,t){if(!l()){var n=function(e){return t?e:v(e,"data")?e.data:e},o=he(d.parse);m.Function(o)?n=o:o&&m.String(o)&&(n=function(e){return De(e,o)}),u(n(e,r,i)),i.sync(r)}},onError:function(e){u(void 0),l()||(s||function(e){return re(e.message||"fetch fail "+d.action)})(e,r,i)}});e.$handle.beforeFetch(p,{rule:r,api:i}).then((function(){m.Function(d.action)?d.action(r,i).then((function(e){p.onSuccess(e,!0)})).catch((function(e){p.onError(e)})):xe((function(){return e.create.fetch(p,{inject:t,rule:r,api:i})}))}))}),a.wait||600))}else u(void 0)}var n={name:"fetch",_fn:[],mounted:function(){t.apply(void 0,arguments)},watch:function(){t.apply(void 0,arguments)},deleted:function(e){this._fn[e.id]&&this._fn[e.id](),e.clearProp()}};return n},loadData:function(e){var t={name:"loadData",_fn:[],mounted:function(t,n,r){this.deleted(t);var i=x(t.getValue()),o=[];i.forEach((function(i){if(i&&(i.attr||i.template)){var a=e.watchLoadData(J((function(o){var a;a=i.template?e.$handle.loadStrVar(i.template,o):o(i.attr,i.default),!1!==i.copy&&(a=A(a));var u=i.modify?n:t.getProp();"child"===i.to?u.children?u.children[0]=a:u.children=[a]:Ue(u,i.to||"options",a),r.sync(n)}),i.wait||300));!1!==i.watch?o.push(a):a()}})),this._fn[t.id]=o},deleted:function(e){this._fn[e.id]&&this._fn[e.id].forEach((function(e){e()})),e.clearProp()}};return t.watch=t.created,t},componentValidate:it};function at(e){e=e||new Map;var t={$on:function(t,n){var r=e.get(t);r&&r.push(n)||e.set(t,[n])},$once:function(e,n){n._once=!0,t.$on(e,n)},$off:function(t,n){var r=e.get(t);r&&r.splice(r.indexOf(n)>>>0,1)},$emit:function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];(e.get(n)||[]).slice().map((function(e){e._once&&(t.$off(n,e),delete e._once),e.apply(void 0,i)})),(e.get("*")||[]).slice().map((function(e){e(n,i)}))}};return t}var ut={name:"html",loadChildren:!1,render:function(e,t){return t.prop.props.innerHTML=e.default(),t.vNode.make(t.prop.props.tag||"div",t.prop)},renderChildren:function(e){return{default:function(){return e.filter((function(e){return m.String(e)})).join("")}}}};function ct(e){e+="=";for(var t=decodeURIComponent(document.cookie).split(";"),n=0;n<t.length;n++){for(var r=t[n];" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(e)){r=r.substring(e.length,r.length);try{return JSON.parse(r)}catch(e){return r}}}return null}function st(e){var t=localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return t}return null}function lt(e,t){if(!t)return null;var n=t.split("."),r=e(n.shift());return n.length?null==r?null:De(r,n):r}function ft(e){return lt(ct,e)}function dt(e){return lt(st,e)}function pt(e,t){var n;return 2===arguments.length?t=(n=arguments[1])[e]:n=arguments[2],{id:t,prop:n}}function ht(){return pt.apply(void 0,["name"].concat(Array.prototype.slice.call(arguments)))}var mt=1,vt={};function gt(e){var n,r=c({},Qe.name,Qe),i={},u={},s={},l={},f=[],d=[],h=[e.extendApi],g=o({},ot),y=Pe(),b={global:{}},$=t.reactive({}),_=tt(),w={},x=!0===e.isMobile,C={};function O(e){var t=vt[e];return Array.isArray(t)?t.map((function(e){return e.api()})):t?t.api():void 0}function S(e){f.push(e)}function V(){var e=ht.apply(void 0,arguments);e.id&&e.prop&&(u[e.id]=e.prop)}function k(){var e=ht.apply(void 0,arguments);e.id&&e.prop&&(g[e.id]=m.Function(e.prop)?e.prop:o(o({},e.prop),{},{name:e.id}))}function D(e){_.use(e)}function j(){var e=ht.apply(void 0,arguments);if(!e.id||!e.prop)return Ke;var t=ie(e.id),n=e.prop,r=!0===n.merge?i[t]:void 0;i[t]=Se(n,r||Ke),y[t]=je(t),n.maker&&N(y,n.maker)}function F(e,t){var n;if(m.String(e)){if(n=e,void 0===t)return r[n]}else n=e.displayName||e.name,t=e;if(n&&t){var o=ie(n);r[n]=t,r[o]=t,delete _.aliasMap[n],delete _.aliasMap[o],delete i[n],delete i[o],t.formCreateParser&&j(n,t.formCreateParser)}}function R(){return H(te,r,u)}function E(){return Qe}function P(e,t){return m.Function(e.install)?e.install(M,t):m.Function(e)&&e(M,t),this}function M(e,n){var r=function(e,n){var r=R();return t.createApp({data:function(){return t.reactive({rule:e,option:n})},render:function(){return t.h(r,o({ref:"fc"},this.$data))}})}(e,n||{});f.forEach((function(e){xe((function(){return e(M,r)}))}));var i=document.createElement("div");return((null==n?void 0:n.el)||document.body).appendChild(i),r.mount(i).$refs.fc.fapi}function B(t){var n=o({},e);return t?n.inherit={components:r,parsers:i,directives:u,modelFields:s,providers:g,useApps:f,maker:y,formulas:w,loadData:$}:delete n.inherit,gt(n)}function I(e,t){s[e]=t}function L(e,t){w[e]=t}function U(e,t){var n=l[e]||{},r=n.parsers||{};t.parsers&&Object.keys(t.parsers).forEach((function(e){r[e]=Se(t.parsers[e],Ke)})),t.name=e,l[e]=o(o(o({},n),t),{},{parsers:r})}function q(e){e&&Object.keys(vt).forEach((function(t){(Array.isArray(vt[t])?vt[t]:[vt[t]]).forEach((function(t){t.bus.$emit("$loadData."+e)}))}))}function W(e,t){Ue($,e,t),q(e)}function G(e,t){var n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return xe((function(){return t.apply(void 0,n)}))};n._driver=!0,W(e,n)}function Y(e,t){var n=(e||"").split(".");e=n.shift();var r=n.join(".");if(v($,e)){var i=$[e];return i&&i._driver?i=i(r):n.length&&(i=De(i,n)),null==i||""===i?t:i}return t}function z(e){h.push(e)}function K(e){delete $[e],q(e)}function X(e,t){d.push({name:e,callback:t})}function te(n){var o=this;N(this,{id:mt++,create:M,vm:n,manager:nt(e.manager),parsers:i,providers:g,modelFields:s,formulas:w,isMobile:x,rules:n.props.rule,name:n.props.name||Le(),inFor:n.props.inFor,prop:{components:r,directives:u},drivers:l,renderDriver:null,refreshData:q,loadData:$,CreateNode:_,bus:new at,unwatch:[],options:t.ref({}),extendApiFn:h,fetchCache:new WeakMap,tmpData:{}}),d.forEach((function(e){o.bus.$on(e.name,e.callback)})),t.nextTick((function(){t.watch(o.options,(function(){o.$handle.$manager.updateOptions(o.options.value),o.api().refresh()}),{deep:!0})})),N(n.appContext.components,r),N(n.appContext.directives,u),this.$handle=new Ze(this),this.name&&(this.inFor?(vt[this.name]||(vt[this.name]=[]),vt[this.name].push(this)):vt[this.name]=this)}function ne(t){N(t,{version:e.version,ui:e.ui,isMobile:x,extendApi:z,getData:Y,setDataDriver:G,setData:W,removeData:K,refreshData:q,maker:y,component:F,directive:V,setModelField:I,setFormula:L,setDriver:U,register:k,$vnode:E,parser:j,use:P,factory:B,componentAlias:D,copyRule:ge,copyRules:ye,mergeRule:be,fetch:Te,$form:R,parseFn:he,parseJson:me,toJson:de,useApp:S,getApi:O,on:X})}if(function(e){var t=e.key||[],n=e.array||[],r=e.normal||[];Z.push.apply(Z,p(t)),Q.push.apply(Q,p(n)),ee.push.apply(ee,p(r)),Re([].concat(p(t),p(n),p(r)))}(e.attrs||{}),Se(M,C),te.isMobile=x,N(te.prototype,{init:function(){var e=this;this.isSub()&&this.unwatch.push(t.watch((function(){return e.vm.setupState.parent.setupState.fc.options.value}),(function(){e.initOptions(),e.$handle.api.refresh()}),{deep:!0})),this.vm.props.driver&&(this.renderDriver="object"===a(this.vm.props.driver)?this.vm.props.driver:this.drivers[this.vm.props.driver]),!this.renderDriver&&this.vm.setupState.parent&&(this.renderDriver=this.vm.setupState.parent.setupState.fc.renderDriver),this.renderDriver||(this.renderDriver=this.drivers.default),this.initOptions(),this.$handle.init()},targetFormDriver:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(this.renderDriver&&this.renderDriver[e])return xe((function(){var n;return(n=t.renderDriver)[e].apply(n,r)}))},globalDataDriver:function(e){var t=this,n=e.split("."),r=n.shift(),i=this.options.value.globalData&&this.options.value.globalData[r];if(i){if("static"===i.type)return De(i.data,n);var o,a=this.fetchCache.get(i);if(a){if(a.status&&(o=De(a.data,n)),!a.loading)return o;a.loading=!1,this.fetchCache.set(i,a)}else this.fetchCache.set(i,{status:!1});var u=J((function(){s();var e=t.fetchCache.get(i);t.options.value.globalData&&-1!==Object.values(t.options.value.globalData).indexOf(i)?(e&&(e.loading=!0,t.fetchCache.set(i,e)),t.bus.$emit("$loadData.$globalData."+r)):t.fetchCache.delete(i)}),i.wait||600),c=function(e){t.fetchCache.set(i,{status:!0,data:e}),t.bus.$emit("$loadData.$globalData."+r)},s=this.watchLoadData((function(e,n){if(n&&!1===i.watch)return s();if(n)u();else{var r=t.$handle.loadFetchVar(T(i),e);t.$handle.api.fetch(r).then((function(e){c(e)})).catch((function(e){c(null)}))}}));return this.unwatch.push(s),o}},globalVarDriver:function(e){var t=this,n=e.split(".").shift(),r=this.options.value.globalVariable&&this.options.value.globalVariable[n];if(r){var i=m.Function(r)?r:r.handle;if(i){var o,a=this.watchLoadData((function(e,r){if(r)return a(),t.bus.$emit("$loadData.$var."+n),o;o=xe((function(){return i(e,t.$handle.api)}))}));return this.unwatch.push(a),o}}},setData:function(e,t,n){n?W(e,t):(Ue(this.vm.setupState.top.setupState.fc.tmpData,e,t),this.bus.$emit("$loadData."+e))},getLoadData:function(e,t){var n=null;if(null!=e){var r=e.split("."),i=r.shift();if("$topForm"===i)n=this.$handle.api.top.formData();else if("$form"===i)n=this.$handle.api.formData();else if("$options"===i)n=this.options.value;else if("$globalData"===i)n=this.globalDataDriver(r.join(".")),r=[];else if("$var"===i)n=this.globalVarDriver(r.join(".")),r=[];else{var o=this.vm.setupState.top.setupState.fc.tmpData;n=v(o,i)?De(o,e):Y(e),r=[]}n&&r.length&&(n=De(n,r))}return null==n||""===n?t:n},watchLoadData:function(e){var t=this,n={},r=function(t){xe((function(){e(i,t)}))},i=function(e,i){if(n[e])return n[e].val;var o=t.getLoadData(e,i),a=e.split("."),u=a.shift(),c=a.shift()||"",s=J((function(){var o=t.getLoadData(e,i);n[e]&&JSON.stringify(o)!==JSON.stringify(n[e].val)&&(n[e].val=o,r(!0))}),0);return t.bus.$on("$loadData."+u,s),c&&t.bus.$on("$loadData."+u+"."+c,s),n[e]={fn:function(){t.bus.$off("$loadData."+u,s),c&&t.bus.$off("$loadData."+u+"."+c,s)},val:o},o};r(!1);var o=function(){Object.keys(n).forEach((function(e){return n[e].fn()})),n={}};return this.unwatch.push(o),o},isSub:function(){return this.vm.setupState.parent&&this.vm.props.extendOption},initOptions:function(){this.options.value={};var e=o({formData:{},submitBtn:{},resetBtn:{},globalEvent:{},globalData:{}},A(b));this.isSub()&&(e=this.mergeOptions(e,this.vm.setupState.parent.setupState.fc.options.value||{},!0)),e=this.mergeOptions(e,this.vm.props.option),this.updateOptions(e)},mergeOptions:function(e,t,n){return t=A(t),n&&["page","onSubmit","mounted","reload","formData","el","globalClass","style"].forEach((function(e){delete t[e]})),t.global&&(e.global=function(e,t){return e?(Object.keys(t||{}).forEach((function(n){t[n]&&(e[n]=be(e[n]||{},t[n]))})),e):t}(e.global,t.global),delete t.global),this.$handle.$manager.mergeOptions([t],e),e},updateOptions:function(e){this.options.value=this.mergeOptions(this.options.value,e),this.$handle.$manager.updateOptions(this.options.value),this.bus.$emit("$loadData.$options")},api:function(){return this.$handle.api},render:function(){return this.$handle.render()},mounted:function(){this.$handle.mounted()},unmount:function(){var e=this;if(this.name)if(this.inFor){var t=vt[this.name].indexOf(this);vt[this.name].splice(t,1)}else delete vt[this.name];d.forEach((function(t){e.bus.$off(t.name,t.callback)})),this.tmpData={},this.unwatch.forEach((function(e){return e()})),this.unwatch=[],this.$handle.reloadRule([])},updated:function(){var e=this;this.$handle.bindNextTick((function(){return e.bus.$emit("next-tick",e.$handle.api)}))}}),ne(C),N(n=C,{create:M,install:function(t,r){b=o(o({},b),r||{});var i="_installedFormCreate_"+e.ui;if(!0!==t[i]){t[i]=!0;var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return M(e,t)};ne(a),t.config.globalProperties.$formCreate=a;var u=R();t.component(u.name,u),f.forEach((function(e){xe((function(){return e(n,t)}))}))}}}),G("$cookie",ft),G("$localStorage",dt),_.use({fragment:"fcFragment"}),e.install&&M.use(e),S((function(e,t){t.mixin({props:["formCreateInject"]})})),j(ut),e.inherit){var re=e.inherit;re.components&&N(r,re.components),re.parsers&&N(i,re.parsers),re.directives&&N(u,re.directives),re.modelFields&&N(s,re.modelFields),re.providers&&N(g,re.providers),re.useApps&&N(f,re.useApps),re.maker&&N(y,re.maker),re.loadData&&N($,re.loadData),re.formulas&&N(w,re.formulas)}var oe=R();return Se(oe,C),Object.defineProperties(oe,{fetch:{get:function(){return C.fetch},set:function(e){C.fetch=e}}}),oe.util=C,oe}var yt="hidden",bt=[{name:yt,maker:c({},yt,(function(e,t){return je(yt)("",e,t)})),render:function(){return[]}},{name:"FcRow",render:function(e,t){return t.vNode.col({props:{span:24}},{default:function(){return[t.vNode.row(t.prop,e)]}})}},{name:"cascader",mergeProp:function(e){var t=e.prop.props;v(t,"options")||(t.options=e.prop.options||[])}},{name:"checkbox",mergeProp:function(e){var t=e.prop.props;v(t,"options")||(t.options=e.prop.options||[])}},{name:"radio",mergeProp:function(e){var t=e.prop.props;v(t,"options")||(t.options=e.prop.options||[])}},{name:"select",mergeProp:function(e){var t=e.prop.props;v(t,"options")||(t.options=e.prop.options||[])}}],$t={button:"van-button",icon:"van-icon",slider:"van-slider",stepper:"van-stepper",rate:"van-rate",uploader:"fc-uploader",cell:"van-cell",timePicker:"fc-time-picker",datePicker:"fc-date-picker",switch:"van-switch",select:"fc-select",cascader:"fc-cascader",calendar:"fc-calendar",checkbox:"fc-checkbox",radio:"fc-radio",input:"van-field",field:"van-field",formItem:"van-field",form:"van-form",col:"van-col",row:"van-row",group:"fc-group",object:"fc-sub-form",subForm:"fc-sub-form"};function _t(e,t){var n;v(e,t)&&(m.String(e[t])&&(e[t]=(c(n={},t,e[t]),c(n,"show",!0),n)))}function wt(e){return!1===e}function xt(e){var t=o({},e);return delete t.children,t}var Ct={validate:function(){var e=this.form();return e?e.validate():new Promise((function(e){return e()}))},validateField:function(e){var t=this;return new Promise((function(n,r){var i=t.form();i?i.validate(e).then(n).catch(r):n()}))},clearValidateState:function(e){var t=this.form();if(t)return t.resetValidation(e.id)},tidyOptions:function(e){return["submitBtn","resetBtn","row","info","wrap","col","title"].forEach((function(t){!function(e,t){v(e,t)&&!m.Object(e[t])&&(e[t]={show:!!e[t]})}(e,t)})),e},tidyRule:function(e){var t=e.prop;return _t(t,"title"),_t(t,"info"),t},mergeProp:function(e){e.prop=K([{info:this.options.info||{},wrap:this.options.wrap||{},col:this.options.col||{},title:this.options.title||{}},e.prop],{info:{icon:!0},title:{},col:{span:24},wrap:{}},{normal:["title","info","col","wrap"]})},getDefaultOptions:function(){return{form:{required:"auto",labelAlign:"right",inputAlign:"right"},row:{show:!0,gutter:0},submitBtn:{type:"primary",loading:!1,disabled:!1,block:!0,innerText:"提交",size:"small",show:!0,col:void 0,click:void 0},resetBtn:{type:"default",loading:!1,disabled:!1,block:!0,innerText:"重置",size:"small",show:!1,col:void 0,click:void 0}}},update:function(){var e=this.options.form;this.rule={props:o({},e),on:{submit:function(e){e.preventDefault()}},class:[e.className,e.class,"form-create-m",this.$handle.preview?"is-preview":""],style:e.style,type:"form"}},beforeRender:function(){var e=this.key,t=this.ref;N(this.rule,{key:e,ref:t})},render:function(e){var t=this;return e.slotLen()&&!this.$handle.preview&&e.setSlot(void 0,(function(){return t.makeFormBtn()})),this.$r(this.rule,wt(this.options.row.show)?e.getSlots():[this.makeRow(e)])},makeWrap:function(e,t){var n=this,r=e.prop,i="".concat(this.key).concat(e.key),a=r.col,u=this.isTitle(r)&&!1!==r.wrap.title,c=this.rule.props.col;delete r.wrap.title;var s=wt(r.wrap.show)?t:this.$r(K([r.wrap,{props:o(o({modelValue:e.rule.value,label:u?r.title.title:void 0},xt(r.wrap||{})),{},{name:e.id,rules:e.injectValidate()}),class:"_fc-form-item",key:"".concat(i,"fi"),ref:e.wrapRef,type:"formItem"}]),o({input:function(){return t}},u?{label:function(){return n.makeInfo(r,i,e)}}:{}));return wt(c)||wt(a.show)?s:this.makeCol(r,i,[s])},isTitle:function(e){if(!1===this.options.form.title)return!1;var t=e.title;return!(!t.title&&!t.native||wt(t.show))},makeInfo:function(e,t,r){var i=o({},e.title),a=o({},e.info),u=this.getSlot("title"),c=[u?u({title:i.title||"",rule:r.rule,options:this.options}):i.title||""],s=!wt(a.show)&&(a.info||a.native)&&!wt(a.icon);s&&c["left"!==a.align?"unshift":"push"](this.$r({type:!0===a.icon?"icon-warning":a.icon,style:"width:1em;"}));var l=K([i,{props:xt(i),key:"".concat(t,"tit"),class:"_fc-title",type:i.type||"span"}]);return s&&a.info&&!l.props.onClick&&(l.props.onClick=function(){n.showNotify({type:"warning",message:a.info,duration:1e3})}),delete l.props.show,delete l.props.title,delete l.props.native,this.$r(l,c)},makeCol:function(e,t,n){var r=e.col;return this.$r({class:r.class,type:"col",props:r||{span:24},key:"".concat(t,"col")},n)},makeRow:function(e){var t=this.options.row||{};return this.$r({type:"row",props:t,class:t.class,key:"".concat(this.key,"row")},e)},makeFormBtn:function(){var e=[];if(wt(this.options.submitBtn.show)||e.push(this.makeSubmitBtn()),wt(this.options.resetBtn.show)||e.push(this.makeResetBtn()),e.length)return this.$r({type:"cell",key:"".concat(this.key,"fb")},e)},makeResetBtn:function(){var e=this,t=o({},this.options.resetBtn),n=t.innerText;return delete t.innerText,delete t.click,delete t.col,delete t.show,this.$r({type:"button",props:t,class:"_fc-reset-btn",style:{width:t.width},on:{click:function(){var t=e.$handle.api;e.options.resetBtn.click?e.options.resetBtn.click(t):t.resetFields()}},key:"".concat(this.key,"b2")},[n])},makeSubmitBtn:function(){var e=this,t=o({},this.options.submitBtn),n=t.innerText;return delete t.innerText,delete t.click,delete t.col,delete t.show,this.$r({type:"button",props:t,class:"_fc-submit-btn",style:{width:t.width},on:{click:function(){var t=e.$handle.api;e.options.submitBtn.click?e.options.submitBtn.click(t):t.submit().catch((function(){}))}},key:"".concat(this.key,"b1")},[n])}};function Ot(e,t){return m.Boolean(e)?e={show:e}:m.Undef(e)||m.Object(e)||(e={show:t}),e}function St(e,t){return{formEl:function(){return t.$manager.form()},wrapEl:function(e){var n=t.getFieldCtx(e);if(n)return t.vm.refs[n.wrapRef]},validate:function(n){return new Promise((function(r,i){var o=e.children,a=[t.$manager.validate()];o.forEach((function(e){a.push(e.validate())})),Promise.all(a).then((function(){r(!0),n&&n(!0)})).catch((function(r){i(r),n&&n(r),t.vm.emit("validate-fail",r,{api:e})}))}))},validateField:function(n,r){return new Promise((function(i,o){var a=t.getFieldCtx(n);if(a){var u=t.subForm[a.id],c=[t.$manager.validateField(a.id)];x(u).forEach((function(e){c.push(e.validate())})),Promise.all(c).then((function(){i(null),r&&r(null)})).catch((function(i){o(i),r&&r(i),t.vm.emit("validate-field-fail",i,{field:n,api:e})}))}}))},clearValidateState:function(n){var r=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.helper.tidyFields(n).forEach((function(e){i&&r.clearSubValidateState(e),t.getCtxs(e).forEach((function(e){t.$manager.clearValidateState(e)}))}))},clearSubValidateState:function(n){e.helper.tidyFields(n).forEach((function(e){t.getCtxs(e).forEach((function(e){var n=t.subForm[e.id];n&&(Array.isArray(n)?n.forEach((function(e){e.clearValidateState()})):n&&n.clearValidateState())}))}))},btn:{loading:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.submitBtnProps({loading:!!t})},disabled:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.submitBtnProps({disabled:!!t})},show:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.submitBtnProps({show:!!t})}},resetBtn:{loading:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.resetBtnProps({loading:!!t})},disabled:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.resetBtnProps({disabled:!!t})},show:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e.resetBtnProps({show:!!t})}},submitBtnProps:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Ot(t.options.submitBtn,!0);N(r,n),t.options.submitBtn=r,e.refreshOptions()},resetBtnProps:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Ot(t.options.resetBtn,!1);N(r,n),t.options.resetBtn=r,e.refreshOptions()},submit:function(n,r){return new Promise((function(i,o){e.validate().then((function(){var r=e.formData();m.Function(n)&&xe((function(){return n(r,e)})),m.Function(t.options.onSubmit)&&xe((function(){return t.options.onSubmit(r,e)})),t.vm.emit("submit",r,e),i(r)})).catch((function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];m.Function(r)&&xe((function(){return r.apply(void 0,[e].concat(n))})),o.apply(void 0,n)}))}))}}}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}('.form-create-m{width:100%}.form-create-m .fc-none,.form-create-m.is-preview .fc-clock{display:none!important}.form-create-m .van-field:has(.van-field__value>.van-field__body>.van-field__control>.van-field):after{display:none}.form-create-m .van-field>.van-field__value>.van-field__body>.van-field__control>.van-field:after{display:block}.form-create-m ._fc-form-item>.van-field__value>.van-field__body>.van-field__control>.van-cell{padding:0}.form-create-m ._fc-form-item ._fc-form-item{--van-padding-md:0;padding-left:0;padding-right:0}.form-create-m>.van-row>.van-col--24:last-of-type>.van-cell:last-of-type:after{display:none}.form-create-m ._fc-reset-btn{margin-top:10px}.form-create-m ._fc-title{align-items:center;display:inline-flex}.form-create-m.is-preview .van-field__label--required:before{display:none}._fc-m-group{align-items:flex-end;display:flex;flex-direction:column;justify-content:center;min-height:38px;width:100%}._fc-m-group-disabled ._fc-m-group-add,._fc-m-group-disabled ._fc-m-group-btn{cursor:not-allowed}._fc-m-group-handle{background-color:#fff;border:1px dashed #d9d9d9;border-radius:15px;bottom:-15px;display:flex;flex-direction:row;padding:3px 8px;position:absolute;right:30px;transform:scale(1.1)}._fc-m-group-btn{cursor:pointer}._fc-m-group-idx{align-items:center;background:#eee;border-radius:15px;bottom:-15px;display:flex;font-weight:700;height:30px;justify-content:center;left:10px;position:absolute;width:30px}._fc-m-group-handle ._fc-m-group-btn+._fc-m-group-btn{margin-left:7px}._fc-m-group-container{border:1px dashed #d9d9d9;border-radius:5px;box-sizing:border-box;display:flex;flex-direction:column;margin-bottom:25px;padding:5px 5px 25px;position:relative;width:100%}._fc-m-group-arrow{height:20px;position:relative;width:20px}._fc-m-group-arrow:before{border-left:2px solid #999;border-top:2px solid #999;content:"";height:9px;left:5px;position:absolute;top:8px;transform:rotate(45deg);width:9px}._fc-m-group-arrow._fc-m-group-down{transform:rotate(180deg)}._fc-m-group-plus-minus{cursor:pointer;height:20px;position:relative;width:20px}._fc-m-group-plus-minus:after,._fc-m-group-plus-minus:before{background-color:#409eff;content:"";height:2px;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);width:60%}._fc-m-group-plus-minus:before{transform:translate(-50%,-50%) rotate(90deg)}._fc-m-group-plus-minus._fc-m-group-minus:before{display:none}._fc-m-group-plus-minus._fc-m-group-minus:after{background-color:#f56c6c}._fc-m-group-add{border:1px solid rgba(64,158,255,.5);border-radius:15px;cursor:pointer;height:25px;transform:scale(1.1);width:25px}._fc-m-group-add._fc-m-group-plus-minus:after,._fc-m-group-add._fc-m-group-plus-minus:before{width:50%}');var Vt={name:"required",load:function(e,t,n){var r=function(e){return m.Boolean(e)?{required:e}:m.String(e)?{message:e}:m.Undef(e)?{required:!1}:m.Function(e)?{validator:e}:m.Object(e)?e:{}}(e.getValue());if(!1===r.required)e.clearProp(),n.clearValidateState([t.field]);else{var i=o({required:!0,validator:function(e){return!m.empty(e)},trigger:["onChange","onSubmit"]},r);if(!i.message){var u=t.title||"";i.message=(("object"===a(u)?u.title:u)||"")+"不能为空"}e.getProp().validate=[i]}n.sync(t)},watch:function(){Vt.load.apply(Vt,arguments)}};function kt(e){e.componentAlias($t),U.forEach((function(t){e.component(t.name,t)})),e.register(Vt),bt.forEach((function(t){e.parser(t)})),n.Field.props&&(n.Field.props.modelValue={type:[String,Number,Array,Object],default:""})}var Dt=gt({ui:"vant",version:"3.2.13",manager:Ct,extendApi:St,install:kt,isMobile:!0,attrs:{normal:["col","wrap"],key:["title","info"]}});"undefined"!=typeof window&&(window.formCreateMobile=Dt);var jt=Dt.maker;e.default=Dt,e.maker=jt,Object.defineProperty(e,"__esModule",{value:!0})}));
